---
title: "Midterm 2: Revisiting Attitudes Toward Covid"
output: 
  rmdformats::readthedown:
    code_folding: hide
    toc_depth: 5
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, results = "hide", fig.keep = "none", message = FALSE, warning = FALSE)
```

There are __165__ total points for this exam. Good luck!

__Note__:  You can leave tables as is and graphs without labels, titles, without changing colours, etc, unless specifically noted in a problem.

(2.5 points) Create a new .Rmd file. Then, copy and paste the following statement and type in your name below:

"I affirm that all work on this exam is entirely my own." - 

<br>

<br>

The exam will use data from Mini-Project 1 on Trump's approval ratings and people's attitudes on Covid-19. The data from Mini-Project 1 has been updated to include polls through November. 

Question 1. (10 points) The `covid_concern_polls.csv` data set contains a variable called `text` that says the text of the question asked on the poll. Use this variable to create a new data set that only has questions with the word "economy" in them.

```{r, echo = TRUE, class.source = "fold-show"}
library(tidyverse)
library(lubridate)
concern_df <- read_csv("covid_concern_polls.csv")
```

```{r}
concern_df %>% mutate(econ = str_detect(text, pattern = "economy")) %>%
  select(econ, everything()) %>%
  filter(econ == TRUE)
```

<br>

Question 2. (30 points) Construct a side-by-side boxplot that compares the `approve` variable on polls that have a `start_date` on a weekend with polls that have a `start_date` on a weekday. Do this even if it doesn't really make much sense to make this type of plot. 

```{r, echo = TRUE, class.source = "fold-show"}
approval_df <- read_csv("covid_approval_polls.csv")
```

```{r}
approval_df <- approval_df %>% mutate(start_date = mdy(start_date)) %>%
  mutate(weekday = wday(start_date)) %>%
  mutate(weekday_ind = case_when(weekday == 1 | weekday == 7 ~ "weekend",
         TRUE ~ "weekday"))
ggplot(data = approval_df, aes(x = weekday_ind, y = approve)) +
  geom_boxplot()
```

<br>

Question 3a. (40 points) __Use only the data where party is `all` in the following question.__

```{r, class.source = "fold-show", echo = TRUE}
approval_all <- read_csv("covid_approval_polls.csv") %>%
  filter(party == "all")
```

Which `pollster`'s sampled the __most__ people in the month of June? Create a point plot that shows the 10 pollsters that sampled the most people, with the pollster that sampled the most people first and the pollster that sampled the 10th most people last. Don't worry about renaming any of the pollsters, even if they have longer names.

__Hint__: This question will get at a lot of different functions and concepts we've used. Try to complete as many parts as you can. For example, suppose you can't really figure out how to get a data set that has the 10 pollsters who sampled the most people in June. Then, make the plot with a different variable!

__Hint 2__: The first thing you'll need to do is put the `start_date` as a `<date>` variable and then create a new variable for `Month`.

```{r}
approval_small <- approval_all %>% mutate(start_date = mdy(start_date)) %>%
  mutate(monthvar = month(start_date, label = TRUE, abbr = FALSE)) %>%
  filter(monthvar == "June") %>%
  group_by(pollster) %>%
  summarise(total_sampled = sum(sample_size)) %>%
  arrange(desc(total_sampled)) %>%
  slice(1:10) %>%
  mutate(pollster2 = fct_reorder(pollster, .x = total_sampled))
ggplot(data = approval_small, aes(x = pollster2, y = total_sampled)) +
  geom_point() + coord_flip()
```

<br>

Question 3b. Give a brief explanation of what each "line" (each pipe) of your code is doing. Using the beginning of this question as an example, I might say "I started by only keeping rows of the data set where party was all with a filter statement."

<br>

Question 4. (10 points) Suppose that the pollster with the largest sample size is biased against Trump. Which method would be better to compute Trump's overall approval rating in June:

* take the total number of people who approve Trump in all surveys and divide by the total number of people surveyed OR
* find the proportion of people who approve of Trump from each pollster and then average those proportions.

Give a 1-2 sentence explanation. 

<br>

Question 5 (10 points). Suppose that, in the Question 3a, you couldn't figure out how to make the `Month` variable, described in __Hint 2__. Write a reprex that someone could use to help you answer that question. To save time, you don't need to include text in your reprex that asks the question: just create the code.

<br>

Question 6a (30 points). Make a scatterplot that has time (`start_date`) on the x-axis, and percent on the y-axis that shows different colours for approval and disapproval, using only the data for the "all" party. Include two smoothers, one for `approve` and one for `disapprove`. The colours should be CVD friendly and you should have a legend that says which colour is approve and which is disapprove.

Finally, change the order of the appearance of `approve` and `disapprove` in the legend so that `disapprove` appears first and `approve` appears second.

__Hint__: Can you create the plot in its current form or will you need to wrangle the data set with a function from early on in the semester?

```{r}
approval_all <- read_csv("covid_approval_polls.csv") %>%
  filter(party == "all")
```

```{r}
approval_all <- approval_all %>%
  mutate(start_date = mdy(start_date))
approval_long <- approval_all %>% pivot_longer(c(approve, disapprove),
                                               names_to = "Type",
                                               values_to = "Percent")
ggplot(data = approval_long, aes(x = start_date, y = Percent)) +
  geom_point(aes(colour = Type)) +
  geom_smooth(aes(colour = Type)) +
  scale_colour_viridis_d()
```

<br>

Question 6b. Give a brief explanation of what each "line" (each pipe) of your code is doing. Using the beginning of this question as an example, I might say "I started by only keeping rows of the data set where party was all with a filter statement."

<br>

Question 7. (5 points) Would you consider your Mini-Project 1 and the above analysis on people's attitudes toward covid more of a hypothesis confirmation or a hypothesis exploration/generation? Give a two sentence reason.

<br>

Question 8. (15 points) Consider the following two data sets. The first, referred to as `data_science` has variables on students in this class, of which there are 29. Of these 29 students, 12 are statistics majors.

The second, referred to as `SLU_stat`, has variables on statistics majors at SLU. Suppose there are 25 statistics majors. As mentioned above, 12 of the 25 majors are in this class.

How many rows will be given in the following joins, assuming that the key "name" matches in both of these data sets.

a. `anti_join(data_science, SLU_stat, by = c("name" = "name"))`

b. `left_join(SLU_stat, data_science, by = c("name" = "name"))`

c. `full_join(SLU_stat, data_science, by = c("name" = "name"))`

d. `semi_join(SLU_stat, data_science, by = c("name" = "name"))`

<br>

Question 9. (7.5 points) Suppose you want to combine `concern_df` and `approval_df`. What is the `key` you would use? Which `join` function would you use and why?
