<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> 7 Tidying with tidyr | STAT 234: Data Science</title>
<meta name="author" content="Matt Higham">
<meta name="description" content="Goals: describe what it means for a data set to be tidy. use separate() and unite() to transform a data set into tidy form. use pivot_longer() and pivot_wider() to transform a data set into tidy...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content=" 7 Tidying with tidyr | STAT 234: Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://highamm.github.io/datascience234/tidying-with-tidyr.html">
<meta property="og:description" content="Goals: describe what it means for a data set to be tidy. use separate() and unite() to transform a data set into tidy form. use pivot_longer() and pivot_wider() to transform a data set into tidy...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" 7 Tidying with tidyr | STAT 234: Data Science">
<meta name="twitter:description" content="Goals: describe what it means for a data set to be tidy. use separate() and unite() to transform a data set into tidy form. use pivot_longer() and pivot_wider() to transform a data set into tidy...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT 234: Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Syllabus and Course Information</a></li>
<li class="book-part">The Core: tidyverse Basics</li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Getting Started with R and R Studio</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">3</span> Plotting with ggplot2</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">4</span> Wrangling with dplyr</a></li>
<li><a class="" href="communication-with-rmarkdown.html"><span class="header-section-number">5</span> Communication with RMarkdown</a></li>
<li><a class="" href="workflow.html"><span class="header-section-number">6</span> Workflow and Other Skills</a></li>
<li class="book-part">Data Wrangling</li>
<li><a class="active" href="tidying-with-tidyr.html"><span class="header-section-number">7</span> Tidying with tidyr</a></li>
<li><a class="" href="coding-in-base-r.html"><span class="header-section-number">8</span> Coding in Base R</a></li>
<li><a class="" href="factors-with-forcats.html"><span class="header-section-number">9</span> Factors with forcats</a></li>
<li><a class="" href="reprexes-and-import.html"><span class="header-section-number">10</span> Reprexes and Import</a></li>
<li><a class="" href="data-ethics.html"><span class="header-section-number">11</span> Data Ethics</a></li>
<li><a class="" href="merging-with-dplyr.html"><span class="header-section-number">12</span> Merging with dplyr</a></li>
<li class="book-part">Special Topics</li>
<li><a class="" href="dates-with-lubridate.html"><span class="header-section-number">13</span> Dates with lubridate</a></li>
<li><a class="" href="text-data-with-tidytext-and-stringr.html"><span class="header-section-number">14</span> Text Data with tidytext and stringr</a></li>
<li><a class="" href="predictive-modeling-with-knn.html"><span class="header-section-number">15</span> Predictive Modeling with knn</a></li>
<li><a class="" href="connections-to-stat-113-stat-213-and-cs-140.html"><span class="header-section-number">16</span> Connections to STAT 113, STAT 213, and CS 140</a></li>
<li><a class="" href="introduction-to-sql-with-dbplyr.html"><span class="header-section-number">17</span> Introduction to SQL with dbplyr</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="tidying-with-tidyr" class="section level1" number="7">
<h1>
<span class="header-section-number"> 7</span> Tidying with <code>tidyr</code><a class="anchor" aria-label="anchor" href="#tidying-with-tidyr"><i class="fas fa-link"></i></a>
</h1>
<!-- For a quiz: unheadr::AOEunits_raw -->
<!-- For a quiz: smoothie data  -->
<p><strong>Goals:</strong></p>
<ul>
<li><p>describe what it means for a data set to be <strong>tidy</strong>.</p></li>
<li><p>use <code>separate()</code> and <code>unite()</code> to transform a data set into tidy form.</p></li>
<li><p>use <code>pivot_longer()</code> and <code>pivot_wider()</code> to transform a data set into tidy form.</p></li>
<li><p>combine <code>tidyr</code> functions with <code>dplyr</code> and <code>ggplot2</code> functions to form a more complete workflow.</p></li>
</ul>
<p><strong>The Data</strong>: We will first use a polling data set that contains variables collected from a few different polls in July 2016 for the U.S. presidential election. The data set was scraped from RealClear politics <a href="https://www.realclearpolitics.com/epolls/latest_polls/president/" class="uri">https://www.realclearpolitics.com/epolls/latest_polls/president/</a> by Dr. Ramler. The variables are:</p>
<ul>
<li>
<code>Poll</code>, the name of the poll</li>
<li>
<code>Date</code>, the date range that the poll was conducted</li>
<li>
<code>Sample</code>, contains the sample size of the poll and whether the poll was of Likely Voters or Registered Voters</li>
<li>
<code>MoE</code>, the margin of error of the poll (recall this term from IntroStat)</li>
<li>
<code>Clinton (D)</code>, the percentage of people in the poll voting for Clinton</li>
<li>
<code>Trump (R)</code>, the percentage of people in the poll voting for Trump</li>
<li>
<code>Johnson (L)</code>, the percentage of people in the poll voting for Johnson</li>
<li>
<code>Steing (G)</code>, the percentage of people in the poll voting for Stein</li>
</ul>
<div id="what-is-tidy-data" class="section level2" number="7.1">
<h2>
<span class="header-section-number">7.1</span> What is Tidy Data?<a class="anchor" aria-label="anchor" href="#what-is-tidy-data"><i class="fas fa-link"></i></a>
</h2>
<p><code>R</code> usually (but not always) works best when your data is in tidy form. A tidy data set has a few characteristics. Note that you should already be quite familiar with tidy data because, up to this point, all of the data sets we have used in this class (and probably most of the data sets that you see in STAT 113 an all of the data sets that you may have seen in STAT 213) are tidy. This definition of tidy data is taken from <code>R for Data Science</code>:</p>
<ol style="list-style-type: decimal">
<li>every variable in the data set is stored in its own column</li>
<li>every case in the data set is stored in its own row</li>
<li>each value of a variable is stored in one cell</li>
<li>values in the data set should <strong>not</strong> contain units</li>
<li>there should not be any table headers or footnotes</li>
</ol>
<p>We will begin by focusing on the first characteristic: every variable in a the data set should be stored in its own column (and correspondingly, number 3: each value of a variable should be stored in one cell).</p>
</div>
<div id="separate-and-unite-columns" class="section level2" number="7.2">
<h2>
<span class="header-section-number">7.2</span> <code>separate()</code> and <code>unite()</code> Columns<a class="anchor" aria-label="anchor" href="#separate-and-unite-columns"><i class="fas fa-link"></i></a>
</h2>
<p>In a fresh .Rmd file (File -&gt; New File -&gt; R Markdown) that is in your Notes project, copy and paste the following code into an <code>R</code> chunk:</p>
<div class="sourceCode" id="cb208"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="va">polls</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/rcp-polls.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="st">"--"</span><span class="op">)</span>
<span class="va">polls</span>
<span class="co">#&gt; # A tibble: 7 x 8</span>
<span class="co">#&gt;   Poll        Date    Sample   MoE `Clinton (D)` `Trump (R)`</span>
<span class="co">#&gt;   &lt;chr&gt;       &lt;chr&gt;   &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monmouth    7/14 -… 688 LV   3.7            45          43</span>
<span class="co">#&gt; 2 CNN/ORC     7/13 -… 872 RV   3.5            42          37</span>
<span class="co">#&gt; 3 ABC News/W… 7/11 -… 816 RV   4              42          38</span>
<span class="co">#&gt; 4 NBC News/W… 7/9 - … 1000 …   3.1            41          35</span>
<span class="co">#&gt; 5 Economist/… 7/9 - … 932 RV   4.5            40          37</span>
<span class="co">#&gt; 6 Associated… 7/7 - … 837 RV  NA              40          36</span>
<span class="co">#&gt; 7 McClatchy/… 7/5 - … 1053 …   3              40          35</span>
<span class="co">#&gt; # … with 2 more variables: Johnson (L) &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Stein (G) &lt;dbl&gt;</span></code></pre></div>
<p>Suppose that you wanted to know what the average sample size of the polls was. Using <code>dplyr</code> functions,</p>
<div class="sourceCode" id="cb209"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls</span> |&gt; <span class="fu">summarise</span><span class="op">(</span>meansample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sample</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>What warning do you get? Why?</p>
<p>You would get a similar warning (or sometimes an error) any time that you want to try to use <code>Sample</code> size in plotting or summaries. The issue is that the <code>Sample</code> column actually contains two variables so the data set is not tidy.</p>
<div id="separate-a-column" class="section level3" number="7.2.1">
<h3>
<span class="header-section-number">7.2.1</span> <code>separate()</code> a Column<a class="anchor" aria-label="anchor" href="#separate-a-column"><i class="fas fa-link"></i></a>
</h3>
<p>Let’s <code>separate()</code> the two variables into <code>Sample_size</code> and <code>Sample_type</code>:</p>
<div class="sourceCode" id="cb210"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 x 9</span>
<span class="co">#&gt;   Poll     Date  Sample_size Sample_type   MoE `Clinton (D)`</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monmouth 7/14… 688         LV            3.7            45</span>
<span class="co">#&gt; 2 CNN/ORC  7/13… 872         RV            3.5            42</span>
<span class="co">#&gt; 3 ABC New… 7/11… 816         RV            4              42</span>
<span class="co">#&gt; 4 NBC New… 7/9 … 1000        RV            3.1            41</span>
<span class="co">#&gt; 5 Economi… 7/9 … 932         RV            4.5            40</span>
<span class="co">#&gt; 6 Associa… 7/7 … 837         RV           NA              40</span>
<span class="co">#&gt; 7 McClatc… 7/5 … 1053        RV            3              40</span>
<span class="co">#&gt; # … with 3 more variables: Trump (R) &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Johnson (L) &lt;dbl&gt;, Stein (G) &lt;dbl&gt;</span></code></pre></div>
<p>The arguments to <code>separate()</code> are fairly easy to learn:</p>
<ul>
<li><p><code>col</code> is the name of the column in the data set you want to separate.</p></li>
<li><p><code>into</code> is the name of the new columns. These could be anything you want, and are entered in as a vector (with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> to separate the names)</p></li>
<li><p><code>sep</code> is the character that you want to separate the column by. In this case, the sample size and sample type were separated by whitespace, so our <code>sep = " "</code>, white space.</p></li>
</ul>
<p>The <code>sep</code> argument is the newest piece of information here. Note that even using <code>sep = ""</code> will produce an error (there is not a space now, so <code>R</code> doesn’t know what to separate by).</p>
<div class="sourceCode" id="cb211"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span></code></pre></div>
<p>Similarly, we would like the <code>Date</code> column to be separated into a poll start date and a poll end date:</p>
<div class="sourceCode" id="cb212"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_sep</span> <span class="op">&lt;-</span> <span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,
           sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span></code></pre></div>
<p>Why should you use <code>" - "</code> as the separator instead of <code>"-"</code>? Try using <code>"-"</code> if you aren’t sure: you shouldn’t get an error but something should look off.</p>
<p>What happened to <code>Sample</code>? Why is it back to its un-separated form?</p>
</div>
<div id="unite-columns" class="section level3" number="7.2.2">
<h3>
<span class="header-section-number">7.2.2</span> <code>unite()</code> Columns<a class="anchor" aria-label="anchor" href="#unite-columns"><i class="fas fa-link"></i></a>
</h3>
<p><code>unite()</code> is the “opposite” of <code>separate()</code>: use it when one variable is stored across multiple columns, but each row still represents a single case. The need to use <code>unite()</code> is less common than <code>separate()</code>. In our current data set, there is no need to use it at all. But, for the sake of seeing an example, let’s separate the <code>Start</code> date into <code>month</code> and <code>day</code> and then use <code>unite()</code> to re-unite those columns:</p>
<div class="sourceCode" id="cb213"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_sillytest</span> <span class="op">&lt;-</span> <span class="va">polls_sep</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Start</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start_month"</span>, <span class="st">"Start_day"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>
<span class="va">polls_sillytest</span>
<span class="co">#&gt; # A tibble: 7 x 10</span>
<span class="co">#&gt;   Poll              Start_month Start_day End   Sample   MoE</span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;chr&gt;       &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monmouth          7           14        7/16  688 LV   3.7</span>
<span class="co">#&gt; 2 CNN/ORC           7           13        7/16  872 RV   3.5</span>
<span class="co">#&gt; 3 ABC News/Wash Po… 7           11        7/14  816 RV   4  </span>
<span class="co">#&gt; 4 NBC News/Wall St… 7           9         7/13  1000 …   3.1</span>
<span class="co">#&gt; 5 Economist/YouGov  7           9         7/11  932 RV   4.5</span>
<span class="co">#&gt; 6 Associated Press… 7           7         7/11  837 RV  NA  </span>
<span class="co">#&gt; 7 McClatchy/Marist  7           5         7/9   1053 …   3  </span>
<span class="co">#&gt; # … with 4 more variables: Clinton (D) &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Trump (R) &lt;dbl&gt;, Johnson (L) &lt;dbl&gt;, Stein (G) &lt;dbl&gt;</span></code></pre></div>
<p>This situation could occur in practice: the date variable is in multiple columns: one for month and one for day (and if there are multiple years, there could be a third for year). We would use <code>unite()</code> to combine these two columns into a single <code>Date</code>, called <code>New_start_date</code>:</p>
<div class="sourceCode" id="cb214"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_sillytest</span> |&gt;
  <span class="fu">unite</span><span class="op">(</span><span class="st">"New_start_date"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Start_month</span>, <span class="va">Start_day</span><span class="op">)</span>,
        sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 7 x 9</span>
<span class="co">#&gt;   Poll       New_start_date End   Sample   MoE `Clinton (D)`</span>
<span class="co">#&gt;   &lt;chr&gt;      &lt;chr&gt;          &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monmouth   7/14           7/16  688 LV   3.7            45</span>
<span class="co">#&gt; 2 CNN/ORC    7/13           7/16  872 RV   3.5            42</span>
<span class="co">#&gt; 3 ABC News/… 7/11           7/14  816 RV   4              42</span>
<span class="co">#&gt; 4 NBC News/… 7/9            7/13  1000 …   3.1            41</span>
<span class="co">#&gt; 5 Economist… 7/9            7/11  932 RV   4.5            40</span>
<span class="co">#&gt; 6 Associate… 7/7            7/11  837 RV  NA              40</span>
<span class="co">#&gt; 7 McClatchy… 7/5            7/9   1053 …   3              40</span>
<span class="co">#&gt; # … with 3 more variables: Trump (R) &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Johnson (L) &lt;dbl&gt;, Stein (G) &lt;dbl&gt;</span></code></pre></div>
<p>Note how <code>unite()</code> just switches around the first two arguments of <code>separate()</code>. Argument 1 is now the name of the new column and Argument 2 is the names of columns in the data set that you want to combine.</p>
<p>We have also used the <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> function in <code>separate()</code> and <code>unite()</code>. While <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> is a very general <code>R</code> function and isn’t specific to tidy data, this is the first time that we’re seeing it in this course. <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> officially stands for concatenate, but, in simpler terms, <code><a href="https://rdrr.io/r/base/c.html">c()</a></code> combines two or more “things,” separated by a comma.</p>
<div class="sourceCode" id="cb215"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>
<span class="co">#&gt; [1] 1 4 2</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"D"</span><span class="op">)</span>
<span class="co">#&gt; [1] "A" "A" "D"</span></code></pre></div>
<p>This is useful if a function argument expects two or more “things”: for example, in <code>separate()</code>, the <code>into</code> argument requires two column names for this example. Those column names must be specified by combining the names together with <code><a href="https://rdrr.io/r/base/c.html">c()</a></code>.</p>
</div>
<div id="column-names-and-rename" class="section level3" number="7.2.3">
<h3>
<span class="header-section-number">7.2.3</span> Column Names and <code>rename()</code><a class="anchor" aria-label="anchor" href="#column-names-and-rename"><i class="fas fa-link"></i></a>
</h3>
<p>You might have noticed that the columns with percentage of votes for Clinton, Trump, etc. are surrounded by backticks ` ` when you print <code>polls</code> or <code>polls_sep</code>:</p>
<div class="sourceCode" id="cb216"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_sep</span>
<span class="co">#&gt; # A tibble: 7 x 9</span>
<span class="co">#&gt;   Poll    Start End   Sample   MoE `Clinton (D)` `Trump (R)`</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monmou… 7/14  7/16  688 LV   3.7            45          43</span>
<span class="co">#&gt; 2 CNN/ORC 7/13  7/16  872 RV   3.5            42          37</span>
<span class="co">#&gt; 3 ABC Ne… 7/11  7/14  816 RV   4              42          38</span>
<span class="co">#&gt; 4 NBC Ne… 7/9   7/13  1000 …   3.1            41          35</span>
<span class="co">#&gt; 5 Econom… 7/9   7/11  932 RV   4.5            40          37</span>
<span class="co">#&gt; 6 Associ… 7/7   7/11  837 RV  NA              40          36</span>
<span class="co">#&gt; 7 McClat… 7/5   7/9   1053 …   3              40          35</span>
<span class="co">#&gt; # … with 2 more variables: Johnson (L) &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Stein (G) &lt;dbl&gt;</span></code></pre></div>
<p>This happens because the column names have a space in them (this also would occur if the columns started with a number or had odd special characters in them). Then, any time you want to reference a variable, you need the include the backticks:</p>
<div class="sourceCode" id="cb217"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_sep</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>meanclinton <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="fu">Clinton</span> <span class="op">(</span><span class="va">D</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">## throws an error</span>
<span class="va">polls_sep</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>meanclinton <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">`Clinton (D)`</span><span class="op">)</span><span class="op">)</span> <span class="co">## backticks save the day!</span></code></pre></div>
<p>Having variable names with spaces doesn’t technically violate any principle of tidy data, but it can be quite annoying. Always using backticks can be a huge pain. We can rename variables easily with <code>rename()</code>, which just takes a series of <code>new_name = old_name</code> arguments.</p>
<div class="sourceCode" id="cb218"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_new</span> <span class="op">&lt;-</span> <span class="va">polls_sep</span> |&gt;
  <span class="fu">rename</span><span class="op">(</span>Clinton_D <span class="op">=</span> <span class="va">`Clinton (D)`</span>, Trump_R <span class="op">=</span> <span class="va">`Trump (R)`</span>,
         Johnson_L <span class="op">=</span> <span class="va">`Johnson (L)`</span>, Stein_G <span class="op">=</span> <span class="va">`Stein (G)`</span><span class="op">)</span>
<span class="va">polls_new</span>
<span class="co">#&gt; # A tibble: 7 x 9</span>
<span class="co">#&gt;   Poll  Start End   Sample   MoE Clinton_D Trump_R Johnson_L</span>
<span class="co">#&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monm… 7/14  7/16  688 LV   3.7        45      43         5</span>
<span class="co">#&gt; 2 CNN/… 7/13  7/16  872 RV   3.5        42      37        13</span>
<span class="co">#&gt; 3 ABC … 7/11  7/14  816 RV   4          42      38         8</span>
<span class="co">#&gt; 4 NBC … 7/9   7/13  1000 …   3.1        41      35        11</span>
<span class="co">#&gt; 5 Econ… 7/9   7/11  932 RV   4.5        40      37         5</span>
<span class="co">#&gt; 6 Asso… 7/7   7/11  837 RV  NA          40      36         6</span>
<span class="co">#&gt; 7 McCl… 7/5   7/9   1053 …   3          40      35        10</span>
<span class="co">#&gt; # … with 1 more variable: Stein_G &lt;dbl&gt;</span></code></pre></div>
<p><code>rename()</code> can also be very useful if you have variable names that are very long to type out. <code>rename()</code> is actually from <code>dplyr</code>, not <code>tidyr</code>, but we didn’t have a need for it with any of the <code>dplyr</code> data sets.</p>
</div>
<div id="exercise-4-1" class="section level3" number="7.2.4">
<h3>
<span class="header-section-number">7.2.4</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-4-1"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="tidying-with-tidyr.html#solutions-4">7.5</a>.</p>
<p>The MLB salary data set contains salaries on all 862 players in Major League Baseball in 2016. The data set was obtained from <a href="http://www.usatoday.com/sports/mlb/salaries/2016/player/all/" target="_blank">http://www.usatoday.com/sports/mlb/salaries/2016/player/all/</a></p>
<ol style="list-style-type: decimal">
<li>Read in the data using the following code chunk and write a sentence or two that explains why the data set is not tidy.</li>
</ol>
<div class="sourceCode" id="cb219"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="va">baseball_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/mlb2016.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">baseball_df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 7</span>
<span class="co">#&gt;   Name    Team  POS   Salary   Years  Total.Value Avg.Annual</span>
<span class="co">#&gt;   &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt;  &lt;chr&gt;       &lt;chr&gt;     </span>
<span class="co">#&gt; 1 Clayto… LAD   SP    $ 33,00… 7 (20… $ 215,000,… $ 30,714,…</span>
<span class="co">#&gt; 2 Zack G… ARI   SP    $ 31,79… 6 (20… $ 206,500,… $ 34,416,…</span>
<span class="co">#&gt; 3 David … BOS   SP    $ 30,00… 7 (20… $ 217,000,… $ 31,000,…</span>
<span class="co">#&gt; 4 Miguel… DET   1B    $ 28,00… 10 (2… $ 292,000,… $ 29,200,…</span>
<span class="co">#&gt; 5 Justin… DET   SP    $ 28,00… 7 (20… $ 180,000,… $ 25,714,…</span>
<span class="co">#&gt; 6 Yoenis… NYM   CF    $ 27,32… 3 (20… $ 75,000,0… $ 25,000,…</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>* Tidy the data set just so that</li>
</ol>
<ul>
<li>
<code>Duration</code> of the salary contract (currently given in the <code>Year</code> column) is in its own column</li>
<li>the year range (also currently given in the <code>Year</code> column) is split into a variable called <code>Start</code> and a variable called <code>End</code> year that give the start and end years of the contract. You can still have special characters for now (like <code>(</code> and <code>)</code>) in the start and end year.</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li><p>You should have received a warning message. What does this message mean? See if you can figure it out by typing <code><a href="https://rdrr.io/r/utils/View.html">View(baseball_df)</a></code> in your console window and scrolling down to some of the rows that the warning mentions: 48, 59, 60, etc.</p></li>
<li><p>We won’t learn about <code>parse_number()</code> until <code>readr</code>, but the function is straightforward enough to mention here. It’s useful when you have extra characters in the values of a numeric variable (like a <code><a href="https://rdrr.io/r/base/Extract.html">$</a></code> or a <code>(</code>), but you just want to grab the actual number:</p></li>
</ol>
<div class="sourceCode" id="cb220"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baseball_df</span> <span class="op">&lt;-</span> <span class="va">baseball_df</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>Salary <span class="op">=</span> <span class="fu">parse_number</span><span class="op">(</span><span class="va">Salary</span><span class="op">)</span>,
         Total.Value <span class="op">=</span> <span class="fu">parse_number</span><span class="op">(</span><span class="va">Total.Value</span><span class="op">)</span>,
         Avg.Annual <span class="op">=</span> <span class="fu">parse_number</span><span class="op">(</span><span class="va">Avg.Annual</span><span class="op">)</span>,
         Start <span class="op">=</span> <span class="fu">parse_number</span><span class="op">(</span><span class="va">Start</span><span class="op">)</span>,
         End <span class="op">=</span> <span class="fu">parse_number</span><span class="op">(</span><span class="va">End</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>Run the code above so that the parsing is saved to <code>baseball_df</code>.</p>
<ol start="5" style="list-style-type: decimal">
<li><p>* Using a function from <code>dplyr</code>. fix the <code>End</code> variable that you created so that, for example, the first observation is <code>2020</code> instead of just <code>20</code>.</p></li>
<li><p>* <code>tidyr</code> is extremely useful, but it’s not glamorous. What you end up with is a data set that <code>ggplot2</code> and <code>dplyr</code> can use to do cool things. So, let’s do something with our tidy data set to make all that tidying a little worth it before moving on. Make a graphic that investigates how player <code>Salary</code> compares for different <code>POS</code>.</p></li>
<li><p>* State the reason why making that plot would not have worked before we tidied the data set.</p></li>
</ol>
</div>
</div>
<div id="reshaping-with-pivot_" class="section level2" number="7.3">
<h2>
<span class="header-section-number">7.3</span> Reshaping with <code>pivot_()</code><a class="anchor" aria-label="anchor" href="#reshaping-with-pivot_"><i class="fas fa-link"></i></a>
</h2>
<p>We will continue to use the polling data set to introduce the pivoting functions and data reshaping. To make sure that we are all working with the same data set, run the following line of code:</p>
<div class="sourceCode" id="cb221"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_clean</span> <span class="op">&lt;-</span> <span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>  |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,
           sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span> |&gt; 
  <span class="fu">rename</span><span class="op">(</span>Clinton_D <span class="op">=</span> <span class="va">`Clinton (D)`</span>, Trump_R <span class="op">=</span> <span class="va">`Trump (R)`</span>,
         Johnson_L <span class="op">=</span> <span class="va">`Johnson (L)`</span>, Stein_G <span class="op">=</span> <span class="va">`Stein (G)`</span><span class="op">)</span>
<span class="va">polls_clean</span>
<span class="co">#&gt; # A tibble: 7 x 10</span>
<span class="co">#&gt;   Poll   Start End   Sample_size Sample_type   MoE Clinton_D</span>
<span class="co">#&gt;   &lt;chr&gt;  &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Monmo… 7/14  7/16  688         LV            3.7        45</span>
<span class="co">#&gt; 2 CNN/O… 7/13  7/16  872         RV            3.5        42</span>
<span class="co">#&gt; 3 ABC N… 7/11  7/14  816         RV            4          42</span>
<span class="co">#&gt; 4 NBC N… 7/9   7/13  1000        RV            3.1        41</span>
<span class="co">#&gt; 5 Econo… 7/9   7/11  932         RV            4.5        40</span>
<span class="co">#&gt; 6 Assoc… 7/7   7/11  837         RV           NA          40</span>
<span class="co">#&gt; 7 McCla… 7/5   7/9   1053        RV            3          40</span>
<span class="co">#&gt; # … with 3 more variables: Trump_R &lt;dbl&gt;, Johnson_L &lt;dbl&gt;,</span>
<span class="co">#&gt; #   Stein_G &lt;dbl&gt;</span></code></pre></div>
<p>The data set <code>polls_clean</code> <strong>still</strong> isn’t tidy!! The <code>candidate</code> variable is spread out over 4 different columns and the values in each of these 4 columns actually represent 1 variable: poll percentage.</p>
<p>Thinking about data “tidyness” using the definitions above can sometimes be a little bit confusing. In practice, oftentimes we will usually realize that a data set is untidy when we go to do something that should be super simple but that something turns out to not be super simple at all when the data is in its current form.</p>
<p>For example, one thing we might want to do is to make a plot that has poll <code>Start</code> time on the x-axis, polling numbers on the y-axis, and has candidates represented by different colours. For this small data set, we might not see any trends through time, but you could imagine this graph would be quite useful if we had polling numbers through June, July, August, September, etc.</p>
<p>Take a moment to think about how you would make this graph in <code>ggplot2</code>: what is your x-axis variable? What variable are you specifying for the y-axis? For the colours?</p>
<p>A first attempt in making a graph would be:</p>
<div class="sourceCode" id="cb222"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb222-1"><a href="tidying-with-tidyr.html#cb222-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> polls_clean, <span class="fu">aes</span>(<span class="at">x =</span> Start, <span class="at">y =</span> Clinton_D)) <span class="sc">+</span> </span>
<span id="cb222-2"><a href="tidying-with-tidyr.html#cb222-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour =</span> ....??????????))</span></code></pre></div>
<p>And we’re stuck. It’s certainly not impossible to make the graph with the data in its current form (keep adding <code>geom_point()</code> and re-specifying the aesthetics, then manually specify colours, then manually specify a legend), but it’s definitely a huge pain.</p>
<p>This is where <code>pivot_longer()</code> can help! <a href="https://www.youtube.com/watch?v=8w3wmQAMoxQ" target="_blank">https://www.youtube.com/watch?v=8w3wmQAMoxQ</a></p>
<div id="pivot_longer-to-gather-columns" class="section level3" number="7.3.1">
<h3>
<span class="header-section-number">7.3.1</span> <code>pivot_longer()</code> to Gather Columns<a class="anchor" aria-label="anchor" href="#pivot_longer-to-gather-columns"><i class="fas fa-link"></i></a>
</h3>
<p><code>pivot_longer()</code> “pivots” the data set so that is has more rows (hence the “longer”) by collapsing multiple columns into two columns. One new column is a “key” column, which is the new variable containing the old data set’s column names. The second new column is a “value” column, which is the new variable containing the old data set’s values for each of the old data set’s column names. It’s easier to see this with an example. We know from our plotting exercise above that we’d really like a <code>candidate</code> variable to colour by and a <code>poll_percent</code> variable for the y-axis of our plot. So, we can use <code>pivot_longer()</code> to make these two columns:</p>
<div class="sourceCode" id="cb223"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_clean</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Clinton_D</span>, <span class="va">Trump_R</span>, <span class="va">Johnson_L</span>, <span class="va">Stein_G</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"candidate"</span>, values_to <span class="op">=</span> <span class="st">"poll_percent"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 28 x 8</span>
<span class="co">#&gt;    Poll  Start End   Sample_size Sample_type   MoE candidate</span>
<span class="co">#&gt;    &lt;chr&gt; &lt;chr&gt; &lt;chr&gt; &lt;chr&gt;       &lt;chr&gt;       &lt;dbl&gt; &lt;chr&gt;    </span>
<span class="co">#&gt;  1 Monm… 7/14  7/16  688         LV            3.7 Clinton_D</span>
<span class="co">#&gt;  2 Monm… 7/14  7/16  688         LV            3.7 Trump_R  </span>
<span class="co">#&gt;  3 Monm… 7/14  7/16  688         LV            3.7 Johnson_L</span>
<span class="co">#&gt;  4 Monm… 7/14  7/16  688         LV            3.7 Stein_G  </span>
<span class="co">#&gt;  5 CNN/… 7/13  7/16  872         RV            3.5 Clinton_D</span>
<span class="co">#&gt;  6 CNN/… 7/13  7/16  872         RV            3.5 Trump_R  </span>
<span class="co">#&gt;  7 CNN/… 7/13  7/16  872         RV            3.5 Johnson_L</span>
<span class="co">#&gt;  8 CNN/… 7/13  7/16  872         RV            3.5 Stein_G  </span>
<span class="co">#&gt;  9 ABC … 7/11  7/14  816         RV            4   Clinton_D</span>
<span class="co">#&gt; 10 ABC … 7/11  7/14  816         RV            4   Trump_R  </span>
<span class="co">#&gt; # … with 18 more rows, and 1 more variable:</span>
<span class="co">#&gt; #   poll_percent &lt;dbl&gt;</span></code></pre></div>
<p><code>pivot_longer()</code> has three important arguments:</p>
<ul>
<li>
<code>cols</code>, the names of the columns that you want to PIVOT!</li>
<li>
<code>names_to</code>, the name of the new variable that will have the old column names (anything you want it to be!)</li>
<li>
<code>values_to</code>, the name of the new variable that will have the old column values (anything you want it to be!)</li>
</ul>
<p>What happens when you omit <code>names_to</code> and <code>values_to</code> arguments? Give it a try!</p>
<p>Now we can make our plot using Week 1 <code>ggplot</code> functions. But don’t forget to give a name to our new “long” data set first!</p>
<div class="sourceCode" id="cb224"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">polls_long</span> <span class="op">&lt;-</span> <span class="va">polls_clean</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Clinton_D</span>, <span class="va">Trump_R</span>, <span class="va">Johnson_L</span>, <span class="va">Stein_G</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"candidate"</span>, values_to <span class="op">=</span> <span class="st">"poll_percent"</span><span class="op">)</span>

<span class="co">## ignore as.Date for now....we will get to dates later!</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">polls_long</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Start</span>, <span class="st">"%m/%d"</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">poll_percent</span>,
           colour <span class="op">=</span> <span class="va">candidate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Poll Start Date"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-tidyr_files/figure-html/unnamed-chunk-20-1.png" width="672"></div>
</div>
<div id="pivot_wider-to-spread-to-multiple-columns" class="section level3" number="7.3.2">
<h3>
<span class="header-section-number">7.3.2</span> <code>pivot_wider()</code> to Spread to Multiple Columns<a class="anchor" aria-label="anchor" href="#pivot_wider-to-spread-to-multiple-columns"><i class="fas fa-link"></i></a>
</h3>
<p>The “opposite” of <code>pivot_longer()</code> is <code>pivot_wider()</code>. We need to use <code>pivot_wider()</code> when one case is actually spread across multiple rows. Again, I typically will realize there is an issue with untidy data when I go to do something that should be simple and it’s not.</p>
<p>Let’s examine some airline safety data that fivethirtyeight used in their Should Travelers Avoid Flying Airlines that Have Had Crashes in the Past? story: <a href="https://fivethirtyeight.com/features/should-travelers-avoid-flying-airlines-that-have-had-crashes-in-the-past/" target="_blank">https://fivethirtyeight.com/features/should-travelers-avoid-flying-airlines-that-have-had-crashes-in-the-past/</a>
. The raw data can be found <a href="https://github.com/fivethirtyeight/data/tree/master/airline-safety" target="_blank">here</a>.</p>
<div class="sourceCode" id="cb225"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="va">airlines</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/airline-safety.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">airlines</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 8</span>
<span class="co">#&gt;   airline avail_seat_km_p… `incidents 1985… `fatal_accident…</span>
<span class="co">#&gt;   &lt;chr&gt;              &lt;dbl&gt;            &lt;dbl&gt;            &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Aer Li…        320906734                2                0</span>
<span class="co">#&gt; 2 Aerofl…       1197672318               76               14</span>
<span class="co">#&gt; 3 Aeroli…        385803648                6                0</span>
<span class="co">#&gt; 4 Aerome…        596871813                3                1</span>
<span class="co">#&gt; 5 Air Ca…       1865253802                2                0</span>
<span class="co">#&gt; 6 Air Fr…       3004002661               14                4</span>
<span class="co">#&gt; # … with 4 more variables: fatalities 1985_1999 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   incidents 2000_2014 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   fatal_accidents 2000_2014 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   fatalities 2000_2014 &lt;dbl&gt;</span></code></pre></div>
<p>The data set contains the following columns:</p>
<ul>
<li>
<code>airline</code>, the name of the airline</li>
<li>
<code>avail_seat_km_per_week</code>, the available seat kilometers flown each week</li>
<li>
<code>incidents 1985_1999</code>, the number of incidents between 1985 and 1999</li>
<li>
<code>fatal_accidents 1985_1999</code>, the number of fatal accidents between 1985 and 1999</li>
<li>
<code>fatalities 1985_1999</code>, the number of fatalities between 1985 and 1999</li>
<li><code>incidents 2000_2014</code></li>
<li><code>fatal_accidents 2000_2014</code></li>
<li><code>fatalities 2000_2014</code></li>
</ul>
<p>There’s a whole lot of mess in this data set: we really want a variable for year that has two values (1985-1999 and 2000-2014). Sometimes it’s tough to know where to even start, but one strategy is to draw a sketch of a data frame that you’d like to <strong>end</strong> with. For example, we think that we want a data set with the following columns: airline, available seat km, years, incidents, fatal accidents, and fatalities. So, our sketch might look something like:</p>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th>airline</th>
<th>avail</th>
<th>years</th>
<th>incidents</th>
<th>fatalacc</th>
<th>fatalities</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>airline1</td>
<td>1009391</td>
<td>1985-1999</td>
<td>0</td>
<td>1</td>
<td>2</td>
</tr>
<tr class="even">
<td>airline1</td>
<td>1009391</td>
<td>2000-2014</td>
<td>9</td>
<td>1</td>
<td>1</td>
</tr>
<tr class="odd">
<td>airline2</td>
<td>2141</td>
<td>1985-1999</td>
<td>2</td>
<td>0</td>
<td>0</td>
</tr>
</tbody>
</table></div>
<p>etc.</p>
<p>Let’s start with <code>pivot_longer()</code> to see if we can get year to be its own variable (We know that a year variable, which is what we want, will make more rows so <code>pivot_longer()</code> seems like a good place to start):</p>
<div class="sourceCode" id="cb226"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airlines</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type_year"</span>,
  values_to <span class="op">=</span> <span class="st">"total_num"</span><span class="op">)</span> 
<span class="co">#&gt; # A tibble: 336 x 4</span>
<span class="co">#&gt;    airline   avail_seat_km_per_… type_year         total_num</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;                 &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Aer Ling…           320906734 incidents 1985_1…         2</span>
<span class="co">#&gt;  2 Aer Ling…           320906734 fatal_accidents …         0</span>
<span class="co">#&gt;  3 Aer Ling…           320906734 fatalities 1985_…         0</span>
<span class="co">#&gt;  4 Aer Ling…           320906734 incidents 2000_2…         0</span>
<span class="co">#&gt;  5 Aer Ling…           320906734 fatal_accidents …         0</span>
<span class="co">#&gt;  6 Aer Ling…           320906734 fatalities 2000_…         0</span>
<span class="co">#&gt;  7 Aeroflot*          1197672318 incidents 1985_1…        76</span>
<span class="co">#&gt;  8 Aeroflot*          1197672318 fatal_accidents …        14</span>
<span class="co">#&gt;  9 Aeroflot*          1197672318 fatalities 1985_…       128</span>
<span class="co">#&gt; 10 Aeroflot*          1197672318 incidents 2000_2…         6</span>
<span class="co">#&gt; # … with 326 more rows</span></code></pre></div>
<p>Instead of giving <code>pivot_longer()</code> names of variables, we gave it the column numbers instead. So <code><a href="https://rdrr.io/r/base/c.html">c(3, 4, 5, 6, 7, 8)</a></code> corresponds to the 3rd, 4th, …., 8th columns in the data set. That didn’t quite give us a <code>year</code> variable, but we should be excited to see an opportunity to take advantage of <code>separate()</code>:</p>
<div class="sourceCode" id="cb227"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">airlines</span> |&gt; <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type_year"</span>,
                          values_to <span class="op">=</span> <span class="st">"total_num"</span><span class="op">)</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span><span class="va">type_year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 336 x 5</span>
<span class="co">#&gt;    airline   avail_seat_km_per_… type       year   total_num</span>
<span class="co">#&gt;    &lt;chr&gt;                   &lt;dbl&gt; &lt;chr&gt;      &lt;chr&gt;      &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Aer Ling…           320906734 incidents  1985_…         2</span>
<span class="co">#&gt;  2 Aer Ling…           320906734 fatal_acc… 1985_…         0</span>
<span class="co">#&gt;  3 Aer Ling…           320906734 fatalities 1985_…         0</span>
<span class="co">#&gt;  4 Aer Ling…           320906734 incidents  2000_…         0</span>
<span class="co">#&gt;  5 Aer Ling…           320906734 fatal_acc… 2000_…         0</span>
<span class="co">#&gt;  6 Aer Ling…           320906734 fatalities 2000_…         0</span>
<span class="co">#&gt;  7 Aeroflot*          1197672318 incidents  1985_…        76</span>
<span class="co">#&gt;  8 Aeroflot*          1197672318 fatal_acc… 1985_…        14</span>
<span class="co">#&gt;  9 Aeroflot*          1197672318 fatalities 1985_…       128</span>
<span class="co">#&gt; 10 Aeroflot*          1197672318 incidents  2000_…         6</span>
<span class="co">#&gt; # … with 326 more rows</span></code></pre></div>
<p>Is this the format that we want the data set to be in? Depending on the task, it could be. But, we also might want each of the accident <code>type</code>s to be its own variable. That is, we might want to collapse the data set to have a variable for <code>incidents</code>, a variable for <code>fatal_accidents</code>, and a variable for <code>fatalities</code>. If so, we want to add more columns to the data set, so we need to use <code>pivot_wider()</code>.</p>
<div class="sourceCode" id="cb228"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## name the long data set</span>
<span class="va">airlines_long</span> <span class="op">&lt;-</span> <span class="va">airlines</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type_year"</span>,
               values_to <span class="op">=</span> <span class="st">"total_num"</span><span class="op">)</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span><span class="va">type_year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>

<span class="co">## use pivot_wider() to create variables for incidents, fatalities, and</span>
<span class="co">## fatal_accidents:</span>
<span class="va">airlines_long</span> |&gt; <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type</span>,
                              values_from <span class="op">=</span> <span class="va">total_num</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 112 x 6</span>
<span class="co">#&gt;    airline  avail_seat_km_p… year  incidents fatal_accidents</span>
<span class="co">#&gt;    &lt;chr&gt;               &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;           &lt;dbl&gt;</span>
<span class="co">#&gt;  1 Aer Lin…        320906734 1985…         2               0</span>
<span class="co">#&gt;  2 Aer Lin…        320906734 2000…         0               0</span>
<span class="co">#&gt;  3 Aeroflo…       1197672318 1985…        76              14</span>
<span class="co">#&gt;  4 Aeroflo…       1197672318 2000…         6               1</span>
<span class="co">#&gt;  5 Aerolin…        385803648 1985…         6               0</span>
<span class="co">#&gt;  6 Aerolin…        385803648 2000…         1               0</span>
<span class="co">#&gt;  7 Aeromex…        596871813 1985…         3               1</span>
<span class="co">#&gt;  8 Aeromex…        596871813 2000…         5               0</span>
<span class="co">#&gt;  9 Air Can…       1865253802 1985…         2               0</span>
<span class="co">#&gt; 10 Air Can…       1865253802 2000…         2               0</span>
<span class="co">#&gt; # … with 102 more rows, and 1 more variable:</span>
<span class="co">#&gt; #   fatalities &lt;dbl&gt;</span></code></pre></div>
<p><code>pivot_wider()</code> has two main arguments:</p>
<ul>
<li><p><code>names_from</code>, the column in the old data set that will provide the names of the new columns and</p></li>
<li><p><code>values_from</code>, the column in the old data set that will provide the values that fill in the new columns</p></li>
</ul>
<p>We will see more examples of <code>pivot_wider()</code> and <code>pivot_longer()</code> in the Exercises. Note that tidy data isn’t necessarily always better: you might find cases where you need to “untidy” the data by using <code>pivot_longer()</code> or <code>pivot_wider()</code>. However, most functions in <code>R</code> (and in other languages) work best with tidy data.</p>
<p>There are a few more topics to discuss in tidying data. We have not yet discussed the 4th or 5th characteristics of tidy data (cells should not contain units and there should be no headers or footers), but these are usually dealt with when we read in the data. Therefore, these issues will be covered when we discuss <code>readr</code>.</p>
</div>
<div id="exercise-4-2" class="section level3" number="7.3.3">
<h3>
<span class="header-section-number">7.3.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-4-2"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="tidying-with-tidyr.html#solutions-4">7.5</a>.</p>
<ol style="list-style-type: decimal">
<li>Once you have a handle on data science terminology, it’s not too difficult to transfer what you’ve learned to a different language. For example, students in computer science might be more familiar with Python. Google something like “pivot from wide to long in python” to find help on achieving the equivalent of <code>pivot_longer()</code> in Python.</li>
</ol>
<p>The <code>UBSprices2</code> data set contains information on prices of common commodities in cities throughout the world in the years 2003 and 2009. The three commodities in the data set are Rice (1 kg worth), Bread (1 kg worth), and a Big Mac <a href="https://media1.giphy.com/media/Fw5LicDKem6nC/source.gif" class="uri">https://media1.giphy.com/media/Fw5LicDKem6nC/source.gif</a></p>
<div class="sourceCode" id="cb229"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prices_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/UBSprices2.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>* Convert the data set to a tidier form so that there is a <code>year</code> variable and a <code>commodity</code> variable that has 3 values: <code>"bigmac"</code>, <code>"bread"</code>, and <code>"rice"</code>
</li>
</ol>
<p><strong>Hint</strong>: At some point, you will need to separate the commodity from the year in, for example, bread2009. But, you’ll notice this is different than our other uses of <code>separate()</code> because there is no “-” or " " or “/” to use as a separating character. Look at the help for <code>separate()</code> and scroll down to the <code>sep</code> argument to see if you can figure out this issue. The first code chunk below shows the solution for this particular issue in case you only get stuck on this part while the second code chunk shows the entire solution.</p>
<div class="sourceCode" id="cb230"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">separate</span><span class="op">(</span><span class="va">name_of_variable</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newname1"</span>, <span class="st">"newname2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li><p>* Convert your data set from the previous exercise so that <code>commodity</code> is split up into 3 variables: <code>bigmac</code> price, <code>rice</code> price and <code>bread</code> price.</p></li>
<li><p>In which data set would it be easiest to make a line plot with <code>year</code> on the x-axis and price of <code>rice</code> on the y-axis with lines for each <code>city</code>? In which data set would it be easiest to make a line chart with 3 lines, one for each type of commodity, for the city of Amsterdam?</p></li>
</ol>
<p>If you have time, make these plots!</p>
<p><strong>New Data</strong>:</p>
<p>The <code>under5mortality.csv</code> file contains data on mortality for people under the age of 5 in countries around the world (mortality in deaths per 1000 people). The data come from <a href="https://www.gapminder.org/data/" class="uri">https://www.gapminder.org/data/</a>. The data set is <strong>extremely</strong> wide in its current form, having a column for each year in the data set. Read in the data set with</p>
<div class="sourceCode" id="cb231"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mortality_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/under5mortality.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">mortality_df</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 217</span>
<span class="co">#&gt;   `Under five mor… `1800` `1801` `1802` `1803` `1804` `1805`</span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Abkhazia            NA     NA     NA     NA     NA     NA </span>
<span class="co">#&gt; 2 Afghanistan        469.   469.   469.   469.   469.   469.</span>
<span class="co">#&gt; 3 Akrotiri and Dh…    NA     NA     NA     NA     NA     NA </span>
<span class="co">#&gt; 4 Albania            375.   375.   375.   375.   375.   375.</span>
<span class="co">#&gt; 5 Algeria            460.   460.   460.   460.   460.   460.</span>
<span class="co">#&gt; 6 American Samoa      NA     NA     NA     NA     NA     NA </span>
<span class="co">#&gt; # … with 210 more variables: 1806 &lt;dbl&gt;, 1807 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1808 &lt;dbl&gt;, 1809 &lt;dbl&gt;, 1810 &lt;dbl&gt;, 1811 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1812 &lt;dbl&gt;, 1813 &lt;dbl&gt;, 1814 &lt;dbl&gt;, 1815 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1816 &lt;dbl&gt;, 1817 &lt;dbl&gt;, 1818 &lt;dbl&gt;, 1819 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1820 &lt;dbl&gt;, 1821 &lt;dbl&gt;, 1822 &lt;dbl&gt;, 1823 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1824 &lt;dbl&gt;, 1825 &lt;dbl&gt;, 1826 &lt;dbl&gt;, 1827 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1828 &lt;dbl&gt;, 1829 &lt;dbl&gt;, 1830 &lt;dbl&gt;, 1831 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1832 &lt;dbl&gt;, 1833 &lt;dbl&gt;, 1834 &lt;dbl&gt;, 1835 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1836 &lt;dbl&gt;, 1837 &lt;dbl&gt;, 1838 &lt;dbl&gt;, 1839 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1840 &lt;dbl&gt;, 1841 &lt;dbl&gt;, 1842 &lt;dbl&gt;, 1843 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1844 &lt;dbl&gt;, 1845 &lt;dbl&gt;, 1846 &lt;dbl&gt;, 1847 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1848 &lt;dbl&gt;, 1849 &lt;dbl&gt;, 1850 &lt;dbl&gt;, 1851 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1852 &lt;dbl&gt;, 1853 &lt;dbl&gt;, 1854 &lt;dbl&gt;, 1855 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1856 &lt;dbl&gt;, 1857 &lt;dbl&gt;, 1858 &lt;dbl&gt;, 1859 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1860 &lt;dbl&gt;, 1861 &lt;dbl&gt;, 1862 &lt;dbl&gt;, 1863 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1864 &lt;dbl&gt;, 1865 &lt;dbl&gt;, 1866 &lt;dbl&gt;, 1867 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1868 &lt;dbl&gt;, 1869 &lt;dbl&gt;, 1870 &lt;dbl&gt;, 1871 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1872 &lt;dbl&gt;, 1873 &lt;dbl&gt;, 1874 &lt;dbl&gt;, 1875 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1876 &lt;dbl&gt;, 1877 &lt;dbl&gt;, 1878 &lt;dbl&gt;, 1879 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1880 &lt;dbl&gt;, 1881 &lt;dbl&gt;, 1882 &lt;dbl&gt;, 1883 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1884 &lt;dbl&gt;, 1885 &lt;dbl&gt;, 1886 &lt;dbl&gt;, 1887 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1888 &lt;dbl&gt;, 1889 &lt;dbl&gt;, 1890 &lt;dbl&gt;, 1891 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1892 &lt;dbl&gt;, 1893 &lt;dbl&gt;, 1894 &lt;dbl&gt;, 1895 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1896 &lt;dbl&gt;, 1897 &lt;dbl&gt;, 1898 &lt;dbl&gt;, 1899 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1900 &lt;dbl&gt;, 1901 &lt;dbl&gt;, 1902 &lt;dbl&gt;, 1903 &lt;dbl&gt;,</span>
<span class="co">#&gt; #   1904 &lt;dbl&gt;, 1905 &lt;dbl&gt;, …</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>* Notice that there are 217 columns (at the top of the print out of the header, 217 is the second number). When we use <code>tidyr</code>, we aren’t going to want to type out <code><a href="https://rdrr.io/r/base/c.html">c(2, 3, 4, 5, .....)</a></code> all the way up to <code>217</code>! <code>R</code> has short-hand notation that we can use with <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code>. For example, type in <code>4:9</code> in your console window. Use this notation to tidy the <code>mortality_df</code> data set.</li>
</ol>
<p><strong>Note</strong>: You’ll need to add something to your <code>pivot_longer()</code> function to convert the variable <code>Year</code> to numeric. We haven’t talked too much about variable types yet so, after your <code>values_to = "Mortality"</code> statement, add <code>, names_transform = list(Year = as.numeric)</code>, making sure you have a second <code>)</code> to close the <code>pivot_longer()</code> function.</p>
<ol start="6" style="list-style-type: decimal">
<li><p>Make a line plot to look at the overall under 5 mortality trends for each country.</p></li>
<li><p>What is the overall trend in under 5 mortality? Does every single country follow this trend? What looks strange about the plot, specifically about the data collected before 1900?</p></li>
<li><p>Write two short paragraphs about an article found on <a href="https://www.r-bloggers.com/" target="_blank">https://www.r-bloggers.com/</a>. The most important thing for this exercise is to <strong>pick an article that interests you</strong>. There are many to choose from, with multiple posts being put up each day. For the purposes of this assignment though, find an article where the author actually provides code (most have this but there are a few that are more “big-picture” views of certain topics).</p></li>
</ol>
<p>In the first paragraph, answer the following: (a) What is the main purpose of the blog post? (b) What data is/are the author(s) using? (c) What are the main findings? (d) Why was it important for the author to have data in their main findings?</p>
<p>In the second paragraph, discuss (a) Any code that you see that we have explicitly seen in class, (b) Any code that you see that we have not explicitly seen in class, and (c) anything else you find interesting about your article. Then, copy and paste the URL.</p>
</div>
</div>
<div id="chapexercise-4" class="section level2" number="7.4">
<h2>
<span class="header-section-number">7.4</span> Chapter Exercises<a class="anchor" aria-label="anchor" href="#chapexercise-4"><i class="fas fa-link"></i></a>
</h2>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="tidying-with-tidyr.html#solutions-4">7.5</a>.</p>
<p>We will use nfl salary data obtained from FiveThirtyEight that were originally obtained from <a href="https://github.com/rfordatascience/tidytuesday/tree/master/data/2018/2018-04-09" target="_blank">Spotrac.com</a>.</p>
<p>The data set has the top 100 paid players for each year for each position from 2011 through 2018, broken down by player position. For those unfamiliar with American football, the positions in the data set are Quarterback, Running Back, Wide Receiver, Tight End, and Offensive Lineman for offense, Cornerback, Defensive Lineman, Linebacker, and Safety for Defense, and a separate category for Special Teams players that includes punters and kickers. You can review a summary of player positions <a href="https://i.pinimg.com/originals/56/32/87/56328741cb64cd59dafd200c9d06a301.png" target="_blank"> here</a>.</p>
<p>We are interested in how salaries compare for the top 100 players in each position and on how salaries have changed through time for each position.</p>
<p>Read in the data set with</p>
<div class="sourceCode" id="cb232"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nfl_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/nfl_salary.csv"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Use the <code><a href="https://rdrr.io/r/utils/head.html">head()</a></code> functions to look at the data, and then explain why this data set is <strong>not</strong> in tidy form.</p></li>
<li><p>* Use a function in <code>tidyr</code> to make the data tidy, and give your tidy data set a new name.</p></li>
<li><p>* To your data set in the previous exercise, add a ranking variable that ranks the salaries within each player position so that the highest paid players in each position all receive a <code>1</code>, the second highest paid players receive a <code>2</code>, etc. Compare your results for the default way that <code>R</code> uses to break ties between two salaries that are the same and using <code>ties.method = "first"</code>.</p></li>
</ol>
<p><strong>Hint</strong>: See Exercise 4 in <a href="dplyr.html#exercise-3-3">4.3.2</a> for another example on how to do this.</p>
<ol start="4" style="list-style-type: decimal">
<li><p>* Find the maximum salary for each player position in each year. Then, create two different line graphs that shows how the maximum salary has changed from 2011 to 2018 for each position. For one line graph, make the colours of the lines different for each position. For the second line graph, facet by position. Which graph do you like better?</p></li>
<li><p>* The maximum salary is very dependent on one specific player. Make the same graph, but plot the average salary of the top 20 players in each position of each year. What do you notice? Any interesting patterns for any of the positions? If you’re a fan of football, provide a guess as to why one of the positions has had their salary plateau in recent years.</p></li>
<li><p>* Sometimes for graphs involving cost or salary, we want to take into account the inflation rate. Google what the inflation rate was between 2011 and 2018 (Google something like “inflation rate from 2011 to 2018” and you should be able to find something). Adjust all of the 2011 salaries for inflation so that they are comparable to the 2018 salaries. Then, make a similar line plot as above but ignore all of the years between 2012 and 2017 (so your line plot will just have 2 points per position).</p></li>
</ol>
<p>After adjusting for inflation, how many positions have average higher salaries for the top 20 players in that position?</p>
<ol start="7" style="list-style-type: decimal">
<li>Construct a graph that shows how much salary decreases moving from higher ranked players to lower ranked players for each position in the year 2018. Why do you think the depreciation is so large for Quarterbacks?</li>
</ol>
</div>
<div id="solutions-4" class="section level2" number="7.5">
<h2>
<span class="header-section-number">7.5</span> Exercise Solutions<a class="anchor" aria-label="anchor" href="#solutions-4"><i class="fas fa-link"></i></a>
</h2>
<div id="what-is-tidy-data-s" class="section level3" number="7.5.1">
<h3>
<span class="header-section-number">7.5.1</span> What is Tidy Data? S<a class="anchor" aria-label="anchor" href="#what-is-tidy-data-s"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="separate-and-unite-s" class="section level3" number="7.5.2">
<h3>
<span class="header-section-number">7.5.2</span> <code>separate()</code> and <code>unite()</code> S<a class="anchor" aria-label="anchor" href="#separate-and-unite-s"><i class="fas fa-link"></i></a>
</h3>
<ol start="2" style="list-style-type: decimal">
<li>* Tidy the data set just so that</li>
</ol>
<ul>
<li>
<code>Duration</code> of the salary contract (currently given in the <code>Year</code> column) is in its own column</li>
<li>the year range (also currently given in the <code>Year</code> column) is split into a variable called <code>Start</code> and a variable called <code>End</code> year that give the start and end years of the contract. You can still have special characters for now (like <code>(</code> and <code>)</code>) in the start and end year.</li>
</ul>
<div class="sourceCode" id="cb233"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baseball_df</span> <span class="op">&lt;-</span> <span class="va">baseball_df</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span><span class="va">Years</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Duration"</span>, <span class="st">"Range"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span><span class="va">Range</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">"-"</span><span class="op">)</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>* Using a function from <code>dplyr</code>. fix the <code>End</code> variable that you created so that, for example, the first observation is <code>2020</code> instead of just <code>20</code>.</li>
</ol>
<div class="sourceCode" id="cb234"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">baseball_df</span> <span class="op">&lt;-</span> <span class="va">baseball_df</span> |&gt; <span class="fu">mutate</span><span class="op">(</span>End <span class="op">=</span> <span class="va">End</span> <span class="op">+</span> <span class="fl">2000</span><span class="op">)</span></code></pre></div>
<p>This is a somewhat lazy way to do this and could get you into trouble (what if one of the years was in the 1990s?) But, it’s safe for this particular data set.</p>
<ol start="6" style="list-style-type: decimal">
<li>* <code>tidyr</code> is extremely useful, but it’s not glamorous. What you end up with is a data set that <code>ggplot2</code> and <code>dplyr</code> can use to do cool things. So, let’s do something with our tidy data set to make all that tidying a little worth it before moving on. Make a graphic that investigates how player <code>Salary</code> compares for different <code>POS</code>.</li>
</ol>
<div class="sourceCode" id="cb235"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">baseball_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">POS</span>, y <span class="op">=</span> <span class="va">Salary</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_boxplot</span><span class="op">(</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">baseball_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">Salary</span>, colour <span class="op">=</span> <span class="va">POS</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">geom_freqpoly</span><span class="op">(</span><span class="op">)</span> <span class="co">## boxplots look better in this case</span></code></pre></div>
<ol start="7" style="list-style-type: decimal">
<li>* State the reason why making that plot would not have worked before we tidied the data set.</li>
</ol>
<p>The <code>Salary</code> variable had a dollar sign in it so <code>ggplot</code> would not have known how to plot it.</p>
</div>
<div id="pivot_-s" class="section level3" number="7.5.3">
<h3>
<span class="header-section-number">7.5.3</span> <code>pivot_()</code> S<a class="anchor" aria-label="anchor" href="#pivot_-s"><i class="fas fa-link"></i></a>
</h3>
<ol start="2" style="list-style-type: decimal">
<li>* Convert the data set to a tidier form so that there is a <code>year</code> variable and a <code>commodity</code> variable that has 3 values: <code>"bigmac"</code>, <code>"bread"</code>, and <code>"rice"</code>
</li>
</ol>
<p><strong>Hint</strong>: At some point, you will need to separate the commodity from the year in, for example, bread2009. But, you’ll notice this is different than our other uses of <code>separate()</code> because there is no “-” or " " or “/” to use as a separating character. Look at the help for <code>separate()</code> and scroll down to the <code>sep</code> argument to see if you can figure out this issue. The first code chunk below shows the solution for this particular issue in case you only get stuck on this part while the second code chunk shows the entire solution.</p>
<div class="sourceCode" id="cb236"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">separate</span><span class="op">(</span><span class="va">name_of_variable</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"newname1"</span>, <span class="st">"newname2"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">)</span></code></pre></div>
<div class="sourceCode" id="cb237"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prices_long</span> <span class="op">&lt;-</span> <span class="va">prices_df</span> |&gt; <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span><span class="op">)</span>,
  names_to <span class="op">=</span> <span class="st">"commod_year"</span>, values_to <span class="op">=</span> <span class="st">"price"</span><span class="op">)</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="st">"commod_year"</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"commodity"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="op">-</span><span class="fl">4</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">prices_long</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 4</span>
<span class="co">#&gt;   city      commodity year  price</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Amsterdam bigmac    2009     19</span>
<span class="co">#&gt; 2 Amsterdam bread     2009     10</span>
<span class="co">#&gt; 3 Amsterdam rice      2009     11</span>
<span class="co">#&gt; 4 Amsterdam bigmac    2003     16</span>
<span class="co">#&gt; 5 Amsterdam bread     2003      9</span>
<span class="co">#&gt; 6 Amsterdam rice      2003      9</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>* Convert your data set from the previous exercise so that <code>commodity</code> is split up into 3 variables: <code>bigmac</code> price, <code>rice</code> price and <code>bread</code> price.</li>
</ol>
<div class="sourceCode" id="cb238"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">prices_wide</span> <span class="op">&lt;-</span> <span class="va">prices_long</span> |&gt;
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">commodity</span>, values_from <span class="op">=</span> <span class="va">price</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">prices_wide</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   city      year  bigmac bread  rice</span>
<span class="co">#&gt;   &lt;chr&gt;     &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1 Amsterdam 2009      19    10    11</span>
<span class="co">#&gt; 2 Amsterdam 2003      16     9     9</span>
<span class="co">#&gt; 3 Athens    2009      30    13    27</span>
<span class="co">#&gt; 4 Athens    2003      21    12    19</span>
<span class="co">#&gt; 5 Auckland  2009      19    19    13</span>
<span class="co">#&gt; 6 Auckland  2003      19    19     9</span></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li>* Notice that there are 217 columns (at the top of the print out of the header, 217 is the second number). When we use <code>tidyr</code>, we aren’t going to want to type out <code><a href="https://rdrr.io/r/base/c.html">c(2, 3, 4, 5, .....)</a></code> all the way up to <code>217</code>! <code>R</code> has short-hand notation that we can use with <code><a href="https://rdrr.io/r/base/Colon.html">:</a></code>. For example, type in <code>4:9</code> in your console window. Use this notation to tidy the <code>mortality_df</code> data set.</li>
</ol>
<div class="sourceCode" id="cb239"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">mortality_long</span> <span class="op">&lt;-</span> <span class="va">mortality_df</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fl">2</span><span class="op">:</span><span class="fl">217</span>, names_to <span class="op">=</span> <span class="st">"Year"</span>,
               values_to <span class="op">=</span> <span class="st">"Mortality"</span>,
               names_transform <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>Year <span class="op">=</span> <span class="va">as.numeric</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>You’ll need to add something to your <code>pivot_longer()</code> function to convert the variable <code>Year</code> to numeric. We haven’t talked too much about variable types yet so, after your <code>values_to = "Mortality"</code> statement, add <code>, names_transform = list(Year = as.numeric)</code>, making sure you have a second <code>)</code> to close the <code>pivot_longer()</code> function.</p>
</div>
<div id="chapexercise-4-S" class="section level3" number="7.5.4">
<h3>
<span class="header-section-number">7.5.4</span> Chapter Exercises S<a class="anchor" aria-label="anchor" href="#chapexercise-4-S"><i class="fas fa-link"></i></a>
</h3>
<ol start="2" style="list-style-type: decimal">
<li>* Use a function in <code>tidyr</code> to make the data tidy, and give your tidy data set a new name.</li>
</ol>
<div class="sourceCode" id="cb240"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nfl_long</span> <span class="op">&lt;-</span> <span class="va">nfl_df</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span>, <span class="fl">9</span>, <span class="fl">10</span>, <span class="fl">11</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"position"</span>, values_to <span class="op">=</span> <span class="st">"salary"</span><span class="op">)</span>
<span class="va">nfl_long</span>
<span class="co">#&gt; # A tibble: 8,000 x 3</span>
<span class="co">#&gt;     year position            salary</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;chr&gt;                &lt;dbl&gt;</span>
<span class="co">#&gt;  1  2011 Cornerback        11265916</span>
<span class="co">#&gt;  2  2011 Defensive Lineman 17818000</span>
<span class="co">#&gt;  3  2011 Linebacker        16420000</span>
<span class="co">#&gt;  4  2011 Offensive Lineman 15960000</span>
<span class="co">#&gt;  5  2011 Quarterback       17228125</span>
<span class="co">#&gt;  6  2011 Running Back      12955000</span>
<span class="co">#&gt;  7  2011 Safety             8871428</span>
<span class="co">#&gt;  8  2011 Special Teamer     4300000</span>
<span class="co">#&gt;  9  2011 Tight End          8734375</span>
<span class="co">#&gt; 10  2011 Wide Receiver     16250000</span>
<span class="co">#&gt; # … with 7,990 more rows</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>* To your data set in the previous exercise, add a ranking variable that ranks the salaries within each player position so that the highest paid players in each position all receive a <code>1</code>, the second highest paid players receive a <code>2</code>, etc. Compare your results for the default way that <code>R</code> uses to break ties between two salaries that are the same and using <code>ties.method = "first"</code>.</li>
</ol>
<p><strong>Hint</strong>: See Exercise 4 in <a href="dplyr.html#exercise-3-3">4.3.2</a> for another example on how to do this.</p>
<div class="sourceCode" id="cb241"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nfl_long_default</span> <span class="op">&lt;-</span> <span class="va">nfl_long</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">position</span>, <span class="va">year</span><span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">salary</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">nfl_long</span> <span class="op">&lt;-</span> <span class="va">nfl_long</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">position</span>, <span class="va">year</span><span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>rank <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rank.html">rank</a></span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">salary</span><span class="op">)</span>, ties.method <span class="op">=</span> <span class="st">"first"</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>The first ranking code allows observations that have the same ranking get their rankings averaged together (e.g. two observations tied for 5th would get a ranking of (5 + 6) / 2 = 5.5).</p>
<p>In the second ranking method, the first observation in the data set gets the “higher” rank.</p>
<ol start="4" style="list-style-type: decimal">
<li>* Find the maximum salary for each player position in each year. Then, create two different line graphs that shows how the maximum salary has changed from 2011 to 2018 for each position. For one line graph, make the colours of the lines different for each position. For the second line graph, facet by position. Which graph do you like better?</li>
</ol>
<div class="sourceCode" id="cb242"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nfl_max</span> <span class="op">&lt;-</span> <span class="va">nfl_long</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">position</span>, <span class="va">year</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>maxsal <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'position'. You can</span>
<span class="co">#&gt; override using the `.groups` argument.</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nfl_max</span>,
  <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">maxsal</span>, group <span class="op">=</span> <span class="va">position</span>, colour <span class="op">=</span> <span class="va">position</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-tidyr_files/figure-html/unnamed-chunk-45-1.png" width="672"></div>
<div class="sourceCode" id="cb243"><pre class="downlit sourceCode r">
<code class="sourceCode R">
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nfl_max</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">maxsal</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">position</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-tidyr_files/figure-html/unnamed-chunk-45-2.png" width="672"></div>
<p>With this number of levels, I personally prefer the faceted graph for its cleaner look.</p>
<ol start="5" style="list-style-type: decimal">
<li>* The maximum salary is very dependent on one specific player. Make the same graph, but plot the average salary of the top 20 players in each position of each year. What do you notice? Any interesting patterns for any of the positions? If you’re a fan of football, provide a guess as to why one of the positions has had their salary plateau in recent years.</li>
</ol>
<div class="sourceCode" id="cb244"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">nfl_rank</span> <span class="op">&lt;-</span> <span class="va">nfl_long</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rank</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span> |&gt;
  <span class="fu">group_by</span><span class="op">(</span><span class="va">position</span>, <span class="va">year</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>mean20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'position'. You can</span>
<span class="co">#&gt; override using the `.groups` argument.</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nfl_rank</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">mean20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">position</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-tidyr_files/figure-html/unnamed-chunk-46-1.png" width="672"></div>
<p>Running backs haven’t had much of a salary increase whereas all other offensive positions have had a large salary increase. There are many plausible explanations for why this is the case. One is that the NFL is much more of a “passing league” now than it was decades ago.</p>
<ol start="6" style="list-style-type: decimal">
<li>* Sometimes for graphs involving cost or salary, we want to take into account the inflation rate. Google what the inflation rate was between 2011 and 2018 (Google something like “inflation rate from 2011 to 2018” and you should be able to find something). Adjust all of the 2011 salaries for inflation so that they are comparable to the 2018 salaries. Then, make a similar line plot as above but ignore all of the years between 2012 and 2017 (so your line plot will just have 2 points per position).</li>
</ol>
<p>After adjusting for inflation, how many positions have average higher salaries for the top 20 players in that position?</p>
<div class="sourceCode" id="cb245"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## 11.6% from 2011 to 2018.</span>
<span class="va">nfl_inf</span> <span class="op">&lt;-</span> <span class="va">nfl_long</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>salary_inf <span class="op">=</span> <span class="fu">if_else</span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2011</span>,
                              true <span class="op">=</span> <span class="va">salary</span> <span class="op">*</span> <span class="fl">1.116</span>,
                              false <span class="op">=</span> <span class="va">salary</span><span class="op">)</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">year</span> <span class="op">==</span> <span class="fl">2011</span> <span class="op">|</span> <span class="va">year</span> <span class="op">==</span> <span class="fl">2018</span><span class="op">)</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">rank</span> <span class="op">&lt;=</span> <span class="fl">20</span><span class="op">)</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">position</span>, <span class="va">year</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>mean20 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">salary</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> 
<span class="co">#&gt; `summarise()` has grouped output by 'position'. You can</span>
<span class="co">#&gt; override using the `.groups` argument.</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">nfl_inf</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">year</span>, y <span class="op">=</span> <span class="va">mean20</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_line</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">facet_wrap</span><span class="op">(</span> <span class="op">~</span> <span class="va">position</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="04-tidyr_files/figure-html/unnamed-chunk-47-1.png" width="672"></div>
<p>All positions have higher salaries, even after adjusting for inflation, except perhaps running backs (it’s too hard to tell from the graph).</p>
</div>
</div>
<div id="rcode-4" class="section level2" number="7.6">
<h2>
<span class="header-section-number">7.6</span> Non-Exercise <code>R</code> Code<a class="anchor" aria-label="anchor" href="#rcode-4"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb246"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="va">polls</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/rcp-polls.csv"</span><span class="op">)</span>, na <span class="op">=</span> <span class="st">"--"</span><span class="op">)</span>
<span class="va">polls</span>
<span class="va">polls</span> |&gt; <span class="fu">summarise</span><span class="op">(</span>meansample <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">Sample</span><span class="op">)</span><span class="op">)</span>
<span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>
<span class="va">polls_sep</span> <span class="op">&lt;-</span> <span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,
           sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span>
<span class="va">polls_sillytest</span> <span class="op">&lt;-</span> <span class="va">polls_sep</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Start</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start_month"</span>, <span class="st">"Start_day"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>
<span class="va">polls_sillytest</span>
<span class="va">polls_sillytest</span> |&gt;
  <span class="fu">unite</span><span class="op">(</span><span class="st">"New_start_date"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Start_month</span>, <span class="va">Start_day</span><span class="op">)</span>,
        sep <span class="op">=</span> <span class="st">"/"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">2</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"A"</span>, <span class="st">"A"</span>, <span class="st">"D"</span><span class="op">)</span>
<span class="va">polls_sep</span>
<span class="va">polls_new</span> <span class="op">&lt;-</span> <span class="va">polls_sep</span> |&gt;
  <span class="fu">rename</span><span class="op">(</span>Clinton_D <span class="op">=</span> <span class="va">`Clinton (D)`</span>, Trump_R <span class="op">=</span> <span class="va">`Trump (R)`</span>,
         Johnson_L <span class="op">=</span> <span class="va">`Johnson (L)`</span>, Stein_G <span class="op">=</span> <span class="va">`Stein (G)`</span><span class="op">)</span>
<span class="va">polls_new</span>
<span class="va">polls_clean</span> <span class="op">&lt;-</span> <span class="va">polls</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Sample</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Sample_size"</span>, <span class="st">"Sample_type"</span><span class="op">)</span>, 
           sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>  |&gt;
  <span class="fu">separate</span><span class="op">(</span>col <span class="op">=</span> <span class="va">Date</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"Start"</span>, <span class="st">"End"</span><span class="op">)</span>,
           sep <span class="op">=</span> <span class="st">" - "</span><span class="op">)</span> |&gt; 
  <span class="fu">rename</span><span class="op">(</span>Clinton_D <span class="op">=</span> <span class="va">`Clinton (D)`</span>, Trump_R <span class="op">=</span> <span class="va">`Trump (R)`</span>,
         Johnson_L <span class="op">=</span> <span class="va">`Johnson (L)`</span>, Stein_G <span class="op">=</span> <span class="va">`Stein (G)`</span><span class="op">)</span>
<span class="va">polls_clean</span>
<span class="va">polls_clean</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Clinton_D</span>, <span class="va">Trump_R</span>, <span class="va">Johnson_L</span>, <span class="va">Stein_G</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"candidate"</span>, values_to <span class="op">=</span> <span class="st">"poll_percent"</span><span class="op">)</span>
<span class="va">polls_long</span> <span class="op">&lt;-</span> <span class="va">polls_clean</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span>cols <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">Clinton_D</span>, <span class="va">Trump_R</span>, <span class="va">Johnson_L</span>, <span class="va">Stein_G</span><span class="op">)</span>,
               names_to <span class="op">=</span> <span class="st">"candidate"</span>, values_to <span class="op">=</span> <span class="st">"poll_percent"</span><span class="op">)</span>

<span class="co">## ignore as.Date for now....we will get to dates later!</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">polls_long</span>,
       <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/as.Date.html">as.Date</a></span><span class="op">(</span><span class="va">Start</span>, <span class="st">"%m/%d"</span><span class="op">)</span>, y <span class="op">=</span> <span class="va">poll_percent</span>,
           colour <span class="op">=</span> <span class="va">candidate</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span> <span class="fu">xlab</span><span class="op">(</span><span class="st">"Poll Start Date"</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="va">airlines</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/airline-safety.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="va">airlines</span><span class="op">)</span>
<span class="va">airlines</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type_year"</span>,
  values_to <span class="op">=</span> <span class="st">"total_num"</span><span class="op">)</span> 
<span class="va">airlines</span> |&gt; <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type_year"</span>,
                          values_to <span class="op">=</span> <span class="st">"total_num"</span><span class="op">)</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span><span class="va">type_year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>
<span class="co">## name the long data set</span>
<span class="va">airlines_long</span> <span class="op">&lt;-</span> <span class="va">airlines</span> |&gt;
  <span class="fu">pivot_longer</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">4</span>, <span class="fl">5</span>, <span class="fl">6</span>, <span class="fl">7</span>, <span class="fl">8</span><span class="op">)</span>, names_to <span class="op">=</span> <span class="st">"type_year"</span>,
               values_to <span class="op">=</span> <span class="st">"total_num"</span><span class="op">)</span> |&gt;
  <span class="fu">separate</span><span class="op">(</span><span class="va">type_year</span>, into <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"type"</span>, <span class="st">"year"</span><span class="op">)</span>, sep <span class="op">=</span> <span class="st">" "</span><span class="op">)</span>

<span class="co">## use pivot_wider() to create variables for incidents, fatalities, and</span>
<span class="co">## fatal_accidents:</span>
<span class="va">airlines_long</span> |&gt; <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="va">type</span>,
                              values_from <span class="op">=</span> <span class="va">total_num</span><span class="op">)</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="workflow.html"><span class="header-section-number">6</span> Workflow and Other Skills</a></div>
<div class="next"><a href="coding-in-base-r.html"><span class="header-section-number">8</span> Coding in Base R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#tidying-with-tidyr"><span class="header-section-number">7</span> Tidying with tidyr</a></li>
<li><a class="nav-link" href="#what-is-tidy-data"><span class="header-section-number">7.1</span> What is Tidy Data?</a></li>
<li>
<a class="nav-link" href="#separate-and-unite-columns"><span class="header-section-number">7.2</span> separate() and unite() Columns</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#separate-a-column"><span class="header-section-number">7.2.1</span> separate() a Column</a></li>
<li><a class="nav-link" href="#unite-columns"><span class="header-section-number">7.2.2</span> unite() Columns</a></li>
<li><a class="nav-link" href="#column-names-and-rename"><span class="header-section-number">7.2.3</span> Column Names and rename()</a></li>
<li><a class="nav-link" href="#exercise-4-1"><span class="header-section-number">7.2.4</span> Exercises</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#reshaping-with-pivot_"><span class="header-section-number">7.3</span> Reshaping with pivot_()</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#pivot_longer-to-gather-columns"><span class="header-section-number">7.3.1</span> pivot_longer() to Gather Columns</a></li>
<li><a class="nav-link" href="#pivot_wider-to-spread-to-multiple-columns"><span class="header-section-number">7.3.2</span> pivot_wider() to Spread to Multiple Columns</a></li>
<li><a class="nav-link" href="#exercise-4-2"><span class="header-section-number">7.3.3</span> Exercises</a></li>
</ul>
</li>
<li><a class="nav-link" href="#chapexercise-4"><span class="header-section-number">7.4</span> Chapter Exercises</a></li>
<li>
<a class="nav-link" href="#solutions-4"><span class="header-section-number">7.5</span> Exercise Solutions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#what-is-tidy-data-s"><span class="header-section-number">7.5.1</span> What is Tidy Data? S</a></li>
<li><a class="nav-link" href="#separate-and-unite-s"><span class="header-section-number">7.5.2</span> separate() and unite() S</a></li>
<li><a class="nav-link" href="#pivot_-s"><span class="header-section-number">7.5.3</span> pivot_() S</a></li>
<li><a class="nav-link" href="#chapexercise-4-S"><span class="header-section-number">7.5.4</span> Chapter Exercises S</a></li>
</ul>
</li>
<li><a class="nav-link" href="#rcode-4"><span class="header-section-number">7.6</span> Non-Exercise R Code</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT 234: Data Science</strong>" was written by Matt Higham. It was last built on 2022-07-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
