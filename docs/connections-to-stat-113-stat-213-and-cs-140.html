<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title> 16 Connections to STAT 113, STAT 213, and CS 140 | STAT 234: Data Science</title>
<meta name="author" content="Matt Higham">
<meta name="description" content="16.1 STAT 113 In this section, we discuss how what we have learned in this data science course connects to some concepts that you learned about in STAT 113. As a quick refresher, a few concepts...">
<meta name="generator" content="bookdown 0.27 with bs4_book()">
<meta property="og:title" content=" 16 Connections to STAT 113, STAT 213, and CS 140 | STAT 234: Data Science">
<meta property="og:type" content="book">
<meta property="og:url" content="https://highamm.github.io/datascience234/connections-to-stat-113-stat-213-and-cs-140.html">
<meta property="og:description" content="16.1 STAT 113 In this section, we discuss how what we have learned in this data science course connects to some concepts that you learned about in STAT 113. As a quick refresher, a few concepts...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content=" 16 Connections to STAT 113, STAT 213, and CS 140 | STAT 234: Data Science">
<meta name="twitter:description" content="16.1 STAT 113 In this section, we discuss how what we have learned in this data science course connects to some concepts that you learned about in STAT 113. As a quick refresher, a few concepts...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS --><style type="text/css">
    
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  </style>
<link rel="stylesheet" href="bs4_style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">STAT 234: Data Science</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html"><span class="header-section-number">1</span> Syllabus and Course Information</a></li>
<li class="book-part">The Core: tidyverse Basics</li>
<li><a class="" href="intro.html"><span class="header-section-number">2</span> Getting Started with R and R Studio</a></li>
<li><a class="" href="ggplot2.html"><span class="header-section-number">3</span> Plotting with ggplot2</a></li>
<li><a class="" href="dplyr.html"><span class="header-section-number">4</span> Wrangling with dplyr</a></li>
<li><a class="" href="communication-with-rmarkdown.html"><span class="header-section-number">5</span> Communication with RMarkdown</a></li>
<li><a class="" href="workflow.html"><span class="header-section-number">6</span> Workflow and Other Skills</a></li>
<li class="book-part">Data Wrangling</li>
<li><a class="" href="tidying-with-tidyr.html"><span class="header-section-number">7</span> Tidying with tidyr</a></li>
<li><a class="" href="coding-in-base-r.html"><span class="header-section-number">8</span> Coding in Base R</a></li>
<li><a class="" href="factors-with-forcats.html"><span class="header-section-number">9</span> Factors with forcats</a></li>
<li><a class="" href="reprexes-and-import.html"><span class="header-section-number">10</span> Reprexes and Import</a></li>
<li><a class="" href="data-ethics.html"><span class="header-section-number">11</span> Data Ethics</a></li>
<li><a class="" href="merging-with-dplyr.html"><span class="header-section-number">12</span> Merging with dplyr</a></li>
<li class="book-part">Special Topics</li>
<li><a class="" href="dates-with-lubridate.html"><span class="header-section-number">13</span> Dates with lubridate</a></li>
<li><a class="" href="text-data-with-tidytext-and-stringr.html"><span class="header-section-number">14</span> Text Data with tidytext and stringr</a></li>
<li><a class="" href="predictive-modeling-with-knn.html"><span class="header-section-number">15</span> Predictive Modeling with knn</a></li>
<li><a class="active" href="connections-to-stat-113-stat-213-and-cs-140.html"><span class="header-section-number">16</span> Connections to STAT 113, STAT 213, and CS 140</a></li>
<li><a class="" href="introduction-to-sql-with-dbplyr.html"><span class="header-section-number">17</span> Introduction to SQL with dbplyr</a></li>
</ul>

        <div class="book-extra">
          
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="connections-to-stat-113-stat-213-and-cs-140" class="section level1" number="16">
<h1>
<span class="header-section-number"> 16</span> Connections to STAT 113, STAT 213, and CS 140<a class="anchor" aria-label="anchor" href="#connections-to-stat-113-stat-213-and-cs-140"><i class="fas fa-link"></i></a>
</h1>
<div id="stat-113" class="section level2" number="16.1">
<h2>
<span class="header-section-number">16.1</span> STAT 113<a class="anchor" aria-label="anchor" href="#stat-113"><i class="fas fa-link"></i></a>
</h2>
<p>In this section, we discuss how what we have learned in this data science course connects to some concepts that you learned about in STAT 113. As a quick refresher, a few concepts that you learned about in STAT 113 are:</p>
<ul>
<li>exploring data through numerical and graphical summaries. The connection to what we have been doing in this class is fairly straightforward: we’ve learned a lot about how to actually compute those numerical summaries and make appropriate graphics for potentially messy data.</li>
<li>explaining what sampling distributions are and how they relate to confidence intervals and hypothesis tests. This topic is probably the least connected to what we have learned so far in this class.</li>
<li>conducting hypothesis tests and creating confidence intervals to answer questions of interest. We will focus on this third general objective in this section.</li>
</ul>
<p>The example we will use is an experiment designed to assess the effects of race and sex on whether or not an employee received a callback for a job. In order to conduct the experiment, researchers randomly assigned names to resumes with each name associated with a particular race and gender, sent the resumes to employers, and recorded whether or not the resume received a callback. In addition to race, sex, and whether or not an employee received a callback, a few more variables were collected, like resume quality, whether or not the applicant had computer skills, years of experience, etc. A <code>1</code> for the <code>received_callback</code> indicates that the applicant received a callback.</p>
<p>You may recall this example from STAT 113: we used it to introduce a chi-square test of association. In that example and others like it, an appropriate graphic and summary statistics were provided. Here, we create these ourselves.</p>
<p>The data set is called <code>resume</code> in the <code>openintro</code> package: you’ll need to install this package with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("openintro")</a></code>. Then, load in the data with</p>
<div class="sourceCode" id="cb459"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://openintrostat.github.io/openintro/">openintro</a></span><span class="op">)</span>
<span class="co">#&gt; Warning: package 'openintro' was built under R version 4.1.2</span>
<span class="co">#&gt; Loading required package: airports</span>
<span class="co">#&gt; Loading required package: cherryblossom</span>
<span class="co">#&gt; Loading required package: usdata</span>
<span class="co">#&gt; Warning: replacing previous import</span>
<span class="co">#&gt; 'lifecycle::last_warnings' by 'rlang::last_warnings' when</span>
<span class="co">#&gt; loading 'tibble'</span>
<span class="co">#&gt; Warning: replacing previous import</span>
<span class="co">#&gt; 'lifecycle::last_warnings' by 'rlang::last_warnings' when</span>
<span class="co">#&gt; loading 'pillar'</span>
<span class="co">#&gt; Warning: replacing previous import</span>
<span class="co">#&gt; 'lifecycle::last_warnings' by 'rlang::last_warnings' when</span>
<span class="co">#&gt; loading 'hms'</span>
<span class="va">resume</span>
<span class="co">#&gt; # A tibble: 4,870 x 30</span>
<span class="co">#&gt;    job_ad_id job_city job_industry job_type job_fed_contrac…</span>
<span class="co">#&gt;        &lt;dbl&gt; &lt;chr&gt;    &lt;chr&gt;        &lt;chr&gt;               &lt;dbl&gt;</span>
<span class="co">#&gt;  1       384 Chicago  manufacturi… supervi…               NA</span>
<span class="co">#&gt;  2       384 Chicago  manufacturi… supervi…               NA</span>
<span class="co">#&gt;  3       384 Chicago  manufacturi… supervi…               NA</span>
<span class="co">#&gt;  4       384 Chicago  manufacturi… supervi…               NA</span>
<span class="co">#&gt;  5       385 Chicago  other_servi… secreta…                0</span>
<span class="co">#&gt;  6       386 Chicago  wholesale_a… sales_r…                0</span>
<span class="co">#&gt;  7       386 Chicago  wholesale_a… sales_r…                0</span>
<span class="co">#&gt;  8       385 Chicago  other_servi… secreta…                0</span>
<span class="co">#&gt;  9       386 Chicago  wholesale_a… sales_r…                0</span>
<span class="co">#&gt; 10       386 Chicago  wholesale_a… sales_r…                0</span>
<span class="co">#&gt; # … with 4,860 more rows, and 25 more variables:</span>
<span class="co">#&gt; #   job_equal_opp_employer &lt;dbl&gt;, job_ownership &lt;chr&gt;,</span>
<span class="co">#&gt; #   job_req_any &lt;dbl&gt;, job_req_communication &lt;dbl&gt;,</span>
<span class="co">#&gt; #   job_req_education &lt;dbl&gt;, job_req_min_experience &lt;chr&gt;,</span>
<span class="co">#&gt; #   job_req_computer &lt;dbl&gt;, job_req_organization &lt;dbl&gt;,</span>
<span class="co">#&gt; #   job_req_school &lt;chr&gt;, received_callback &lt;dbl&gt;,</span>
<span class="co">#&gt; #   firstname &lt;chr&gt;, race &lt;chr&gt;, gender &lt;chr&gt;,</span>
<span class="co">#&gt; #   years_college &lt;int&gt;, college_degree &lt;dbl&gt;,</span>
<span class="co">#&gt; #   honors &lt;int&gt;, worked_during_school &lt;int&gt;,</span>
<span class="co">#&gt; #   years_experience &lt;int&gt;, computer_skills &lt;int&gt;,</span>
<span class="co">#&gt; #   special_skills &lt;int&gt;, volunteer &lt;int&gt;, military &lt;int&gt;,</span>
<span class="co">#&gt; #   employment_holes &lt;int&gt;, has_email_address &lt;int&gt;,</span>
<span class="co">#&gt; #   resume_quality &lt;chr&gt;</span></code></pre></div>
<div id="chi-square-test-of-association" class="section level3" number="16.1.1">
<h3>
<span class="header-section-number">16.1.1</span> Chi-square Test of Association<a class="anchor" aria-label="anchor" href="#chi-square-test-of-association"><i class="fas fa-link"></i></a>
</h3>
<p>Our goal is to assess whether there is evidence of racial discrimination in the study. In other words, are the variables <code>race</code> and <code>received_callback</code> associated?</p>
<p><strong>Prepare</strong>. Let’s start by writing the null and alternative hypotheses.</p>
<p><span class="math inline">\(H_0:\)</span> There is no association between <code>race</code> and <code>received_callback</code>.</p>
<p><span class="math inline">\(H_a:\)</span> There is an association between <code>race</code> and <code>received_callback</code>.</p>
<p>Next, we can construct a summary graphic. One graphic to explore two categorical variables is a stacked bar plot.</p>
<div class="sourceCode" id="cb460"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="co">#&gt; ── Attaching packages ─────────────────── tidyverse 1.3.1 ──</span>
<span class="co">#&gt; ✓ ggplot2 3.3.5     ✓ purrr   0.3.4</span>
<span class="co">#&gt; ✓ tibble  3.1.2     ✓ dplyr   1.0.7</span>
<span class="co">#&gt; ✓ tidyr   1.1.3     ✓ stringr 1.4.0</span>
<span class="co">#&gt; ✓ readr   2.0.2     ✓ forcats 0.5.1</span>
<span class="co">#&gt; ── Conflicts ────────────────────── tidyverse_conflicts() ──</span>
<span class="co">#&gt; x dplyr::filter() masks stats::filter()</span>
<span class="co">#&gt; x dplyr::lag()    masks stats::lag()</span>
<span class="va">resume_sum</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt; 
  <span class="fu">mutate</span><span class="op">(</span>received_callback <span class="op">=</span> <span class="va">received_callback</span><span class="op">)</span> |&gt;
           <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>, <span class="va">received_callback</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'race'. You can override</span>
<span class="co">#&gt; using the `.groups` argument.</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_sum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">received_callback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-2-1.png" width="672"></div>
<p>What do you notice about the <code>recieved_callback</code> variable scale? How could we fix that?</p>
<div class="sourceCode" id="cb461"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resume</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>received_callback <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">received_callback</span><span class="op">)</span><span class="op">)</span>
<span class="va">resume_sum</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt; 
           <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>, <span class="va">received_callback</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'race'. You can override</span>
<span class="co">#&gt; using the `.groups` argument.</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_sum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">received_callback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-3-1.png" width="672"></div>
<p>We might also want to generate a two-way table:</p>
<div class="sourceCode" id="cb462"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resume</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>, <span class="va">received_callback</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race"</span><span class="op">)</span>,
              values_from <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="co">#&gt; `summarise()` has grouped output by 'race'. You can override</span>
<span class="co">#&gt; using the `.groups` argument.</span>
<span class="co">#&gt; # A tibble: 2 x 3</span>
<span class="co">#&gt;   received_callback black white</span>
<span class="co">#&gt;   &lt;fct&gt;             &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt; 1 0                  2278  2200</span>
<span class="co">#&gt; 2 1                   157   235</span></code></pre></div>
<p><strong>Check</strong>: The two assumptions for the test are independence of observations and that all expected counts are larger than 5. We don’t have time to discuss these in detail but we will assume that they are satisfied here.</p>
<p><strong>Calculate</strong>: We next want to calculate a p-value for the hypothesis test. The core <code>tidyverse</code> packages do not offer functionality for hypothesis testing. Instead, there are some functions in base <code>R</code> that perform the various tests. You may have used the <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> function in STAT 213 to perform hypothesis testing in the regression context. <code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code> and <code><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test()</a></code> are a couple of other functions that can perform a one and two-sample t-test (<code><a href="https://rdrr.io/r/stats/t.test.html">t.test()</a></code>) or a chi-square goodness-of-fit test and chi-square test of association <code><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test()</a></code>.
The arguments to <code><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test()</a></code> for a test of association are two vectors. Because the arguments are not <code>data.frame</code>s, we need to specify the appropriate vectors directly with <code>resume$race</code> and <code>resume$received_callback</code>.</p>
<div class="sourceCode" id="cb463"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resume</span><span class="op">$</span><span class="va">race</span>, y <span class="op">=</span> <span class="va">resume</span><span class="op">$</span><span class="va">received_callback</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;  Pearson's Chi-squared test with Yates' continuity</span>
<span class="co">#&gt;  correction</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; data:  resume$race and resume$received_callback</span>
<span class="co">#&gt; X-squared = 16.449, df = 1, p-value = 4.998e-05</span></code></pre></div>
<p>The output of <code><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test()</a></code> gives a p-value of 0.00004998 with a chi-square statistic of 16.449 and 1 degree of freedom.</p>
<p><strong>Conclude</strong>. Finally, we write a conclusion in context of the problem.</p>
<p>There is strong evidence that <code>race</code> and <code>callback</code> are associated. The graph shows that <code>white</code> applicants receive a callback more often than <code>black</code> applicants do and the hypothesis test shows that this is statistically significant.</p>
</div>
<div id="additional-analysis" class="section level3" number="16.1.2">
<h3>
<span class="header-section-number">16.1.2</span> Additional Analysis<a class="anchor" aria-label="anchor" href="#additional-analysis"><i class="fas fa-link"></i></a>
</h3>
<p>In addition to carrying out the steps of a statistical hypothesis test, we can also use the skills we have learned in this course to provide further information about the study. Some questions we might answer include:</p>
<ul>
<li><p>what is the distribution of job types <code>job_type</code> and job industries <code>job_industry</code> in the study?</p></li>
<li><p>do some of the first names (<code>firstname</code>) used have more bias than other first names?</p></li>
<li><p>what other variables are associated with whether or not the applicant received a callback?</p></li>
</ul>
<p>To answer the question about the distribution of job types and job industries used in the study, we can make a simple bar plot:</p>
<div class="sourceCode" id="cb464"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">job_type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Job Type"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-6-1.png" width="672"></div>
<p>In the code, <code>fct_infreq()</code> orders the levels of <code>job_type</code> from the highest count/frequency to the lowest. <code>fct_rev()</code> reverses the order so that, on the resulting bar plot, the level with the highest count appears first.</p>
<div class="sourceCode" id="cb465"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">job_industry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Job Industry"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-7-1.png" width="672"></div>
<p>To answer the question about whether some first names are more biased than others, we might make a graph of the proportion of resumes that received a callback for each first name.</p>
<div class="sourceCode" id="cb466"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">resume_firstname</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt;
  <span class="fu">group_by</span><span class="op">(</span><span class="va">firstname</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>propcallback <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">received_callback</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>,
            gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span>,
            race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">race</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">propcallback</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">unite</span><span class="op">(</span><span class="st">"gender_race"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">race</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_firstname</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gender_race</span>, y <span class="op">=</span> <span class="va">propcallback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-8-1.png" width="672"></div>
<p>We can the label the name with the lowest callback rate and the name with the highest callback rate.</p>
<div class="sourceCode" id="cb467"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>
<span class="va">label_df</span> <span class="op">&lt;-</span> <span class="va">resume_firstname</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">propcallback</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">propcallback</span><span class="op">)</span> <span class="op">|</span>
           <span class="va">propcallback</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">propcallback</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_firstname</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gender_race</span>, y <span class="op">=</span> <span class="va">propcallback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">label_df</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">firstname</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-9-1.png" width="672"></div>
</div>
<div id="exercise-15-1" class="section level3" number="16.1.3">
<h3>
<span class="header-section-number">16.1.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-15-1"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="connections-to-stat-113-stat-213-and-cs-140.html#solutions-15">16.5</a>.</p>
<ol style="list-style-type: decimal">
<li><p>Construct a graphic or make a table that explores whether one of the other variables in the data set is associated with whether the applicant receives a callback for the job. Other variables include <code>gender</code>, <code>years_college</code>, <code>college_degree</code>, <code>honors</code>, <code>worked_during_school</code>, <code>years_experience</code>, <code>computer_skills</code>, <code>special_skills</code>, <code>volunteer</code>, <code>military</code>, <code>employment_holes</code>, and <code>resume_quality</code>.</p></li>
<li><p>Construct a graphic or make a table that explores one of the other variables in the data set is associated with whether the applicant receives a callback for the job. If your variable in Exercise 1 was categorical, choose a quantitative variable for this exercise. If your variable in Exercise 1 was quantitative, choose a categorical variable for this exercise.</p></li>
<li><p>For the categorical variable that you chose, conduct a Chi-square test of association to see if there is statistical evidence that the variable is associated with <code>received_callback</code>. In your test, (a), write the null and alternative hypotheses, run the test in <code><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test()</a></code> and make a note of whether or not you get a warning about assumptions for the test, and write a conclusion in context of the problem.</p></li>
</ol>
</div>
</div>
<div id="stat-213" class="section level2" number="16.2">
<h2>
<span class="header-section-number">16.2</span> STAT 213<a class="anchor" aria-label="anchor" href="#stat-213"><i class="fas fa-link"></i></a>
</h2>
<p>Much of the same concepts in connecting STAT 113 to this course hold for connecting STAT 213 with this course. We can still use what we have learned to explore a data set, conduct a hypothesis test, and perform further analysis and exploration on the data set.</p>
<p>For this section, however, we will focus more on a tidy approach to modeling. In particular, we will use the <code>broom</code> package to return <code>tibble</code>s with model summary information that we can then use for further analysis, plotting, or presentation.</p>
<p>We will use the <code>coffee_ratings</code> data set, which contains observations on ratings of various coffees throughout the world. The data was obtained from the Github account (<a href="https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-07-07/readme.md" class="uri">https://github.com/rfordatascience/tidytuesday/blob/master/data/2020/2020-07-07/readme.md</a>).</p>
<p>A description of each variable in the data set is given below.</p>
<ul>
<li>
<code>total_cup_points</code>, the score of the coffee by a panel of experts (our response variable for this section)</li>
<li>
<code>species</code>, the species of the coffee bean (Arabica or Robusta)</li>
<li>
<code>aroma</code>, aroma (smell) grade</li>
<li>
<code>flavor</code>, flavor grade</li>
<li>
<code>aftertaste</code>, aftertaste grade</li>
<li>
<code>acidity</code>, acidity grade</li>
<li>
<code>body</code>, body grade</li>
<li>
<code>balance</code>, balance grade</li>
<li>
<code>uniformity</code>, uniformity grade</li>
<li>
<code>clean_cup</code>, clean cup grade</li>
<li>
<code>sweetness</code>, sweetness grade</li>
<li>
<code>moisture</code>, moisture grade</li>
<li>
<code>category_one_defects</code>, count of category one defects</li>
<li>
<code>quakers</code>, quakers</li>
<li>
<code>category_two_defects</code>, the number of category two defects</li>
</ul>
<div id="broom-package-functions" class="section level3" number="16.2.1">
<h3>
<span class="header-section-number">16.2.1</span> <code>broom</code> Package Functions<a class="anchor" aria-label="anchor" href="#broom-package-functions"><i class="fas fa-link"></i></a>
</h3>
<p>The <code>broom</code> package consists of three primary functions: <code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code>, <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code>, and <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code>.</p>
<p><strong><code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code></strong></p>
<p><code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> is analagous to <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> for a linear model object. Let’s start by fitting a linear model with <code><a href="https://rdrr.io/r/stats/lm.html">lm()</a></code> with <code>total_cup_points</code> as the response and <code>species</code>, <code>aroma</code>, <code>flavor</code>, <code>sweetness</code>, and <code>moisture</code> as predictors.</p>
<p>Read in the data, load the <code>broom</code> package (and install it with <code><a href="https://rdrr.io/r/utils/install.packages.html">install.packages("broom")</a></code>), and fit the model with</p>
<div class="sourceCode" id="cb468"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="co">#&gt; here() starts at /Users/highamm/Desktop/datascience234</span>
<span class="va">coffee_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/coffee_ratings.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; Rows: 1339 Columns: 43</span>
<span class="co">#&gt; ── Column specification ────────────────────────────────────</span>
<span class="co">#&gt; Delimiter: ","</span>
<span class="co">#&gt; chr (24): species, owner, country_of_origin, farm_name, ...</span>
<span class="co">#&gt; dbl (19): total_cup_points, number_of_bags, aroma, flavo...</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ℹ Use `spec()` to retrieve the full column specification for this data.</span>
<span class="co">#&gt; ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</span>
<span class="va">coffee_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total_cup_points</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">aroma</span> <span class="op">+</span> <span class="va">flavor</span> <span class="op">+</span>
                   <span class="va">sweetness</span> <span class="op">+</span> <span class="va">moisture</span>,
   data <span class="op">=</span> <span class="va">coffee_df</span><span class="op">)</span></code></pre></div>
<p>In STAT 213, you likely used <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code> to look at the model output:</p>
<div class="sourceCode" id="cb469"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Call:</span>
<span class="co">#&gt; lm(formula = total_cup_points ~ species + aroma + flavor + sweetness + </span>
<span class="co">#&gt;     moisture, data = coffee_df)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residuals:</span>
<span class="co">#&gt;     Min      1Q  Median      3Q     Max </span>
<span class="co">#&gt; -9.5132 -0.3705  0.0726  0.5610  5.5844 </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Coefficients:</span>
<span class="co">#&gt;                Estimate Std. Error t value Pr(&gt;|t|)    </span>
<span class="co">#&gt; (Intercept)     7.04039    0.77377   9.099  &lt; 2e-16 ***</span>
<span class="co">#&gt; speciesRobusta  2.85365    0.26861  10.624  &lt; 2e-16 ***</span>
<span class="co">#&gt; aroma           1.95188    0.14575  13.392  &lt; 2e-16 ***</span>
<span class="co">#&gt; flavor          5.09440    0.14042  36.281  &lt; 2e-16 ***</span>
<span class="co">#&gt; sweetness       2.23956    0.06553  34.173  &lt; 2e-16 ***</span>
<span class="co">#&gt; moisture       -1.88033    0.67368  -2.791  0.00533 ** </span>
<span class="co">#&gt; ---</span>
<span class="co">#&gt; Signif. codes:  </span>
<span class="co">#&gt; 0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Residual standard error: 1.168 on 1333 degrees of freedom</span>
<span class="co">#&gt; Multiple R-squared:  0.8891, Adjusted R-squared:  0.8887 </span>
<span class="co">#&gt; F-statistic:  2137 on 5 and 1333 DF,  p-value: &lt; 2.2e-16</span></code></pre></div>
<p>However, there are a few inconveniences involving <code><a href="https://rdrr.io/r/base/summary.html">summary()</a></code>. First, it’s just not that nice to look at: the output isn’t formatted in a way that is easy to look at. Second, it can be challenging to pull items from the summary output with code. For example, if you want to pull the p-value for <code>moisture</code>, you would need to write something like:</p>
<div class="sourceCode" id="cb470"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"moisture"</span>, <span class="fl">4</span><span class="op">]</span>
<span class="co">#&gt; [1] 0.005327594</span></code></pre></div>
<p><code><a href="https://generics.r-lib.org/reference/tidy.html">tidy()</a></code> is an alternative that puts the model coefficients, standard errors, t-stats, and p-values in a tidy tibble:</p>
<div class="sourceCode" id="cb471"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 5</span>
<span class="co">#&gt;   term           estimate std.error statistic   p.value</span>
<span class="co">#&gt;   &lt;chr&gt;             &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 (Intercept)        7.04    0.774       9.10 3.23e- 19</span>
<span class="co">#&gt; 2 speciesRobusta     2.85    0.269      10.6  2.31e- 25</span>
<span class="co">#&gt; 3 aroma              1.95    0.146      13.4  1.82e- 38</span>
<span class="co">#&gt; 4 flavor             5.09    0.140      36.3  4.73e-201</span>
<span class="co">#&gt; 5 sweetness          2.24    0.0655     34.2  2.41e-184</span>
<span class="co">#&gt; 6 moisture          -1.88    0.674      -2.79 5.33e-  3</span></code></pre></div>
<p>The advantage of this format of output is that we can now use other <code>tidyverse</code> functions on the output. To pull the p-values,</p>
<div class="sourceCode" id="cb472"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">p.value</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 6 x 1</span>
<span class="co">#&gt;     p.value</span>
<span class="co">#&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt; 1 3.23e- 19</span>
<span class="co">#&gt; 2 2.31e- 25</span>
<span class="co">#&gt; 3 1.82e- 38</span>
<span class="co">#&gt; 4 4.73e-201</span>
<span class="co">#&gt; 5 2.41e-184</span>
<span class="co">#&gt; 6 5.33e-  3</span></code></pre></div>
<p>or, to grab the output for a particular variable of interest:</p>
<div class="sourceCode" id="cb473"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"aroma"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   term  estimate std.error statistic  p.value</span>
<span class="co">#&gt;   &lt;chr&gt;    &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1 aroma     1.95     0.146      13.4 1.82e-38</span></code></pre></div>
<p><strong><code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code></strong></p>
<p><code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> puts some model summary statistics into a tidy tibble. For example, if we run</p>
<div class="sourceCode" id="cb474"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 12</span>
<span class="co">#&gt;   r.squared adj.r.squared sigma statistic p.value    df</span>
<span class="co">#&gt;       &lt;dbl&gt;         &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;dbl&gt;</span>
<span class="co">#&gt; 1     0.889         0.889  1.17     2137.       0     5</span>
<span class="co">#&gt; # … with 6 more variables: logLik &lt;dbl&gt;, AIC &lt;dbl&gt;,</span>
<span class="co">#&gt; #   BIC &lt;dbl&gt;, deviance &lt;dbl&gt;, df.residual &lt;int&gt;,</span>
<span class="co">#&gt; #   nobs &lt;int&gt;</span></code></pre></div>
<p>you should notice a lot of statistics that you are familiar with from STAT 213, including <code>r.squared</code>, <code>adj.r.squared</code>, <code>sigma</code> (the residual standard error), <code>statistic</code> (the overall F-statistic), <code>AIC</code>, and <code>BIC</code>.</p>
<p><strong><code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code></strong></p>
<p><code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code> is my personal favourite of the three. The function returns a <code>tibble</code> that contains all of the variables used to fit the model appended with commonly used diagnostic statistics like the fitted values (<code>.fitted)</code>, cook’s distance (<code>.cooksd)</code>, <code>.hat</code> values for leverage, and residuals (<code>.resid</code>).</p>
<div class="sourceCode" id="cb475"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1,339 x 12</span>
<span class="co">#&gt;    total_cup_points species aroma flavor sweetness moisture</span>
<span class="co">#&gt;               &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1             90.6 Arabica  8.67   8.83     10        0.12</span>
<span class="co">#&gt;  2             89.9 Arabica  8.75   8.67     10        0.12</span>
<span class="co">#&gt;  3             89.8 Arabica  8.42   8.5      10        0   </span>
<span class="co">#&gt;  4             89   Arabica  8.17   8.58     10        0.11</span>
<span class="co">#&gt;  5             88.8 Arabica  8.25   8.5      10        0.12</span>
<span class="co">#&gt;  6             88.8 Arabica  8.58   8.42     10        0.11</span>
<span class="co">#&gt;  7             88.8 Arabica  8.42   8.5      10        0.11</span>
<span class="co">#&gt;  8             88.7 Arabica  8.25   8.33      9.33     0.03</span>
<span class="co">#&gt;  9             88.4 Arabica  8.67   8.67      9.33     0.03</span>
<span class="co">#&gt; 10             88.2 Arabica  8.08   8.58     10        0.1 </span>
<span class="co">#&gt; # … with 1,329 more rows, and 6 more variables:</span>
<span class="co">#&gt; #   .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;, .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .cooksd &lt;dbl&gt;, .std.resid &lt;dbl&gt;</span></code></pre></div>
<p><code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code> the data set makes it really easy to do things like:</p>
<ul>
<li>
<code><a href="https://rdrr.io/r/stats/filter.html">filter()</a></code> the data set to examine values with high cook’s distance that might be influential</li>
</ul>
<div class="sourceCode" id="cb476"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">augment_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.cooksd</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 1 x 12</span>
<span class="co">#&gt;   total_cup_points species aroma flavor sweetness moisture</span>
<span class="co">#&gt;              &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1                0 Arabica     0      0         0     0.12</span>
<span class="co">#&gt; # … with 6 more variables: .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .std.resid &lt;dbl&gt;</span></code></pre></div>
<p>We see right away that there is a potentially influential observation with <code>0</code> <code>total_cup_points</code>. Examining this variable further, we see that it is probably a data entry error that can be removed from the data.</p>
<div class="sourceCode" id="cb477"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coffee_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_cup_points</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">15</span>, fill <span class="op">=</span> <span class="st">"white"</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-19-1.png" width="672"></div>
<p>We could also find observations with high leverage</p>
<div class="sourceCode" id="cb478"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.hat</span> <span class="op">&gt;</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 2 x 12</span>
<span class="co">#&gt;   total_cup_points species aroma flavor sweetness moisture</span>
<span class="co">#&gt;              &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt; 1             59.8 Arabica   7.5   6.67      1.33     0.1 </span>
<span class="co">#&gt; 2              0   Arabica   0     0         0        0.12</span>
<span class="co">#&gt; # … with 6 more variables: .fitted &lt;dbl&gt;, .resid &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .std.resid &lt;dbl&gt;</span></code></pre></div>
<p>or observations that are outliers:</p>
<div class="sourceCode" id="cb479"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.std.resid</span> <span class="op">&gt;</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">.std.resid</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">3</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25 x 12</span>
<span class="co">#&gt;    total_cup_points species aroma flavor sweetness moisture</span>
<span class="co">#&gt;               &lt;dbl&gt; &lt;chr&gt;   &lt;dbl&gt;  &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;</span>
<span class="co">#&gt;  1             82.8 Arabica  8.08   8.17     10        0.12</span>
<span class="co">#&gt;  2             82.4 Arabica  5.08   7.75     10        0.11</span>
<span class="co">#&gt;  3             82.3 Arabica  7.75   8.08      6.67     0.11</span>
<span class="co">#&gt;  4             80.7 Arabica  7.67   7.5       6.67     0   </span>
<span class="co">#&gt;  5             80   Arabica  7.58   7.75     10        0   </span>
<span class="co">#&gt;  6             79.9 Arabica  7.83   7.67     10        0   </span>
<span class="co">#&gt;  7             79.2 Arabica  7.17   7.42      6.67     0.1 </span>
<span class="co">#&gt;  8             78.6 Arabica  7.92   7.58     10        0.1 </span>
<span class="co">#&gt;  9             78.3 Arabica  7.17   6.08     10        0.11</span>
<span class="co">#&gt; 10             77.6 Arabica  7.58   7.67      6        0.12</span>
<span class="co">#&gt; # … with 15 more rows, and 6 more variables: .fitted &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .resid &lt;dbl&gt;, .hat &lt;dbl&gt;, .sigma &lt;dbl&gt;, .cooksd &lt;dbl&gt;,</span>
<span class="co">#&gt; #   .std.resid &lt;dbl&gt;</span></code></pre></div>
<p>Finally, we can use our <code>ggplot2</code> skills to construct plots like a residuals versus fitted values plot (filtering out the outlying observation first):</p>
<div class="sourceCode" id="cb480"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.fitted</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.fitted</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> </code></pre></div>
<div class="inline-figure"><img src="15-connections_files/figure-html/unnamed-chunk-22-1.png" width="672"></div>
</div>
<div id="exercise-15-2" class="section level3" number="16.2.2">
<h3>
<span class="header-section-number">16.2.2</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-15-2"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="connections-to-stat-113-stat-213-and-cs-140.html#solutions-15">16.5</a>.</p>
<ol style="list-style-type: decimal">
<li><p>Add a couple of more predictors to the linear model that we fit earlier. Then, use <code><a href="https://generics.r-lib.org/reference/glance.html">glance()</a></code> to obtain some model fit statistics. Which model is “better” according to some of the metrics you learned about in STAT 213?</p></li>
<li><p>For one of your fitted models, construct a histogram of the residuals to assess the normality assumption (using <code>ggplot2</code> and <code><a href="https://generics.r-lib.org/reference/augment.html">augment()</a></code>).</p></li>
<li><p>Make a table of the 5 coffees that have the highest <strong>predicted</strong> coffee rating, according to one of your models.</p></li>
</ol>
</div>
</div>
<div id="cs-140" class="section level2" number="16.3">
<h2>
<span class="header-section-number">16.3</span> CS 140<a class="anchor" aria-label="anchor" href="#cs-140"><i class="fas fa-link"></i></a>
</h2>
<p>In this section, we will repeat a couple of topics from CS 140, which is in Python, in <code>R</code>. In particular we will,</p>
<ul>
<li><p>write our own function. The syntax for doing so in <code>R</code> is <strong>very</strong> similar to Python.</p></li>
<li><p>perform iteration to repeat a similar task multiple times.</p></li>
</ul>
<p>To start, suppose that we are interested in scraping some hitting data on SLU’s baseball team from the web address <a href="https://saintsathletics.com/sports/baseball/stats/2022" class="uri">https://saintsathletics.com/sports/baseball/stats/2022</a>. After we have the hitting data, we want to create a statistic for each player’s weighted on-base-average (<code>wOBA</code>). Information on what the <code>wOBA</code> is can be found here: <a href="https://www.mlb.com/glossary/advanced-stats/weighted-on-base-average" class="uri">https://www.mlb.com/glossary/advanced-stats/weighted-on-base-average</a>.</p>
<p>Code to do such a task is given in the following chunk.</p>
<div class="sourceCode" id="cb481"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Attaching package: 'rvest'</span>
<span class="co">#&gt; The following object is masked from 'package:readr':</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;     guess_encoding</span>

<span class="va">url_SLU</span> <span class="op">&lt;-</span> <span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span>
<span class="va">tab_SLU</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">url_SLU</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
<span class="va">SLU_Hitting</span> <span class="op">&lt;-</span> <span class="va">tab_SLU</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fl">23</span><span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>wOBA <span class="op">=</span> <span class="op">(</span><span class="fl">0.69</span> <span class="op">*</span> <span class="va">BB</span> <span class="op">+</span> <span class="fl">0.72</span> <span class="op">*</span> <span class="va">HBP</span> <span class="op">+</span> <span class="fl">0.89</span> <span class="op">*</span> <span class="op">(</span><span class="va">H</span><span class="op">-</span><span class="va">`2B`</span><span class="op">-</span><span class="va">`3B`</span><span class="op">-</span><span class="va">`HR`</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.27</span> <span class="op">*</span> <span class="va">`2B`</span> <span class="op">+</span> <span class="fl">1.62</span> <span class="op">*</span> <span class="va">`3B`</span> <span class="op">+</span> <span class="fl">2.10</span> <span class="op">*</span> <span class="va">HR</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">AB</span> <span class="op">+</span> <span class="va">BB</span> <span class="op">+</span> <span class="va">SF</span> <span class="op">+</span> <span class="va">HBP</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<p>We can make sure that the statistic was calculated with:</p>
<div class="sourceCode" id="cb482"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">SLU_Hitting</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">wOBA</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">wOBA</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 23</span>
<span class="co">#&gt;     wOBA   `#` Player    AVG   OPS `GP-GS`    AB     R     H</span>
<span class="co">#&gt;    &lt;dbl&gt; &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1 0.514     7 "Brink… 0.556 1.16  5-1         9     3     5</span>
<span class="co">#&gt;  2 0.497    25 "Liber… 0.379 1.16  25-19      66    19    25</span>
<span class="co">#&gt;  3 0.46      1 "Verra… 0.5   1.1   4-0         2     1     1</span>
<span class="co">#&gt;  4 0.452    13 "Butle… 0.325 1.08  35-35     126    31    41</span>
<span class="co">#&gt;  5 0.433     6 "Clark… 0.367 1.02  29-19      79    24    29</span>
<span class="co">#&gt;  6 0.425    11 "Circe… 0.252 1.00  35-33     111    27    28</span>
<span class="co">#&gt;  7 0.412     9 "Burke… 0.308 0.885 6-4        13     4     4</span>
<span class="co">#&gt;  8 0.391    30 "Watso… 0.318 0.853 35-33     110    29    35</span>
<span class="co">#&gt;  9 0.365    19 "Delan… 0.33  0.817 34-34     115    18    38</span>
<span class="co">#&gt; 10 0.358     8 "Forgi… 0.244 0.799 27-27      86    22    21</span>
<span class="co">#&gt; 11 0.356     5 "Desja… 0.284 0.741 28-20      67    23    19</span>
<span class="co">#&gt; 12 0.347    37 "Goret… 0.268 0.771 32-32      97    18    26</span>
<span class="co">#&gt; 13 0.345     3 "Haun,… 0     0.5   11-0        2     1     0</span>
<span class="co">#&gt; 14 0.335    18 "Feder… 0.275 0.733 25-7       40    13    11</span>
<span class="co">#&gt; 15 0.309    23 "Conno… 0.286 0.661 6-0         7     2     2</span>
<span class="co">#&gt; 16 0.294    22 "Court… 0.256 0.63  20-10      39     7    10</span>
<span class="co">#&gt; 17 0.292    20 "Court… 0.281 0.646 27-17      64     6    18</span>
<span class="co">#&gt; 18 0.285    41 "Comer… 0.222 0.582 31-21      72    16    16</span>
<span class="co">#&gt; 19 0.154    24 "Colan… 0.095 0.295 15-3       21     6     2</span>
<span class="co">#&gt; 20 0        36 "Boldu… 0     0     2-0         2     0     0</span>
<span class="co">#&gt; # … with 14 more variables: 2B &lt;int&gt;, 3B &lt;int&gt;, HR &lt;int&gt;,</span>
<span class="co">#&gt; #   RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;,</span>
<span class="co">#&gt; #   SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;,</span>
<span class="co">#&gt; #   SB-ATT &lt;chr&gt;</span></code></pre></div>
<div id="functions" class="section level3" number="16.3.1">
<h3>
<span class="header-section-number">16.3.1</span> Functions<a class="anchor" aria-label="anchor" href="#functions"><i class="fas fa-link"></i></a>
</h3>
<p>Now, suppose that we might want to repeat the scraping and calculation of <code>wOBA</code> for other years at SLU or for other teams. We could, of course, obtain the new URL address and copy and paste the code that we used above, replacing the old URL address with the new one. This would be a reasonable thing to do if we only wanted to do this for <em>one</em> other url. But, if we wanted to do this for 10, 20, 50, 1000, urls, we might consider writing a function to scrape the data and calculate the <code>wOBA</code>.</p>
<p>The format of a function in <code>R</code> is:</p>
<div class="sourceCode" id="cb483"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">name_of_function</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">argument1</span>, <span class="va">argument2</span>, <span class="va">....</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">body_of_function</span> <span class="co">## performs various tasks with the arguments</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">output</span><span class="op">)</span> <span class="co">## tells the function what to return</span>
<span class="op">}</span></code></pre></div>
<p>We have used functions throughout the entire semester, but they have always been functions that others have defined and are imported into <code>R</code> through packages. As we expand our toolbox, we might encounter situations where we want to write our own specialized functions for performing tasks that are not covered by functions that others have written.</p>
<p>Before we get back to our example, let’s write a very simple function, called <code>get_sum_squares</code>, that computes the sum of squares from a numeric vector argument named <code>x_vec</code>. A sum of squares function would take each number in <code>x_vec</code>, square it, and then add the numbers up.</p>
<div class="sourceCode" id="cb484"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_sum_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_vec</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">sum_of_squares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x_vec</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sum_of_squares</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>Now, let’s test our function on the numeric vector <code><a href="https://rdrr.io/r/base/c.html">c(2, 4, 1)</a></code></p>
<div class="sourceCode" id="cb485"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">get_sum_squares</span><span class="op">(</span>x_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; [1] 21</span></code></pre></div>
<p>Now, we will move back to our example. We want to write a function called <code>get_hitting_data</code> that takes a <code>url_name</code>, scrapes the data from that url, and calculates the <code>wOBA</code> from the variables that were scraped. Note that our function will only work on urls that contain a data table formatted with the various baseball statistics as column names.</p>
<p>To create this function, we can simply copy and paste the code above and replace the SLU url web address with the argument <code>url_name</code> in the body of the function.</p>
<div class="sourceCode" id="cb486"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">get_hitting_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url_name</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">url_name</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
  
  <span class="va">hitting</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> |&gt;
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span> |&gt;
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fl">23</span><span class="op">)</span> |&gt;
    <span class="fu">mutate</span><span class="op">(</span>wOBA <span class="op">=</span> <span class="op">(</span><span class="fl">0.69</span> <span class="op">*</span> <span class="va">BB</span> <span class="op">+</span> <span class="fl">0.72</span> <span class="op">*</span> <span class="va">HBP</span> <span class="op">+</span> <span class="fl">0.89</span> <span class="op">*</span> <span class="op">(</span><span class="va">H</span><span class="op">-</span> <span class="va">`2B`</span> <span class="op">-</span> <span class="va">`3B`</span> <span class="op">-</span> <span class="va">`HR`</span><span class="op">)</span> <span class="op">+</span>
                     <span class="fl">1.27</span> <span class="op">*</span> <span class="va">`2B`</span> <span class="op">+</span> <span class="fl">1.62</span> <span class="op">*</span> <span class="va">`3B`</span> <span class="op">+</span> <span class="fl">2.10</span> <span class="op">*</span> <span class="va">HR</span><span class="op">)</span> <span class="op">/</span> 
             <span class="op">(</span><span class="va">AB</span> <span class="op">+</span> <span class="va">BB</span> <span class="op">+</span> <span class="va">SF</span> <span class="op">+</span> <span class="va">HBP</span><span class="op">)</span>,
           url_name <span class="op">=</span> <span class="va">url_name</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">hitting</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
<p>We can then test our function on the SLU url:</p>
<div class="sourceCode" id="cb487"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     6 "Clark… 0.367 1.02  29-19      79    24    29     5</span>
<span class="co">#&gt;  2    19 "Delan… 0.33  0.817 34-34     115    18    38     5</span>
<span class="co">#&gt;  3    13 "Butle… 0.325 1.08  35-35     126    31    41     9</span>
<span class="co">#&gt;  4    30 "Watso… 0.318 0.853 35-33     110    29    35     6</span>
<span class="co">#&gt;  5     5 "Desja… 0.284 0.741 28-20      67    23    19     1</span>
<span class="co">#&gt;  6    20 "Court… 0.281 0.646 27-17      64     6    18     2</span>
<span class="co">#&gt;  7    37 "Goret… 0.268 0.771 32-32      97    18    26     6</span>
<span class="co">#&gt;  8    11 "Circe… 0.252 1.00  35-33     111    27    28     9</span>
<span class="co">#&gt;  9     8 "Forgi… 0.244 0.799 27-27      86    22    21     4</span>
<span class="co">#&gt; 10    41 "Comer… 0.222 0.582 31-21      72    16    16     0</span>
<span class="co">#&gt; 11     7 "Brink… 0.556 1.16  5-1         9     3     5     0</span>
<span class="co">#&gt; 12     1 "Verra… 0.5   1.1   4-0         2     1     1     0</span>
<span class="co">#&gt; 13    25 "Liber… 0.379 1.16  25-19      66    19    25     8</span>
<span class="co">#&gt; 14     9 "Burke… 0.308 0.885 6-4        13     4     4     1</span>
<span class="co">#&gt; 15    23 "Conno… 0.286 0.661 6-0         7     2     2     0</span>
<span class="co">#&gt; 16    18 "Feder… 0.275 0.733 25-7       40    13    11     3</span>
<span class="co">#&gt; 17    22 "Court… 0.256 0.63  20-10      39     7    10     1</span>
<span class="co">#&gt; 18    24 "Colan… 0.095 0.295 15-3       21     6     2     0</span>
<span class="co">#&gt; 19     3 "Haun,… 0     0.5   11-0        2     1     0     0</span>
<span class="co">#&gt; 20    36 "Boldu… 0     0     2-0         2     0     0     0</span>
<span class="co">#&gt; # … with 15 more variables: 3B &lt;int&gt;, HR &lt;int&gt;, RBI &lt;int&gt;,</span>
<span class="co">#&gt; #   TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;, SO &lt;int&gt;,</span>
<span class="co">#&gt; #   GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;, SB-ATT &lt;chr&gt;,</span>
<span class="co">#&gt; #   wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span></code></pre></div>
</div>
<div id="iteration" class="section level3" number="16.3.2">
<h3>
<span class="header-section-number">16.3.2</span> Iteration<a class="anchor" aria-label="anchor" href="#iteration"><i class="fas fa-link"></i></a>
</h3>
<p>Now suppose that we want to use our function to scrape the 2022 baseball statistics for all teams in the Liberty League. There are 10 teams in total. The websites for each team’s statistics as well as the school name is given in the <code>tibble</code> below:</p>
<div class="sourceCode" id="cb488"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">school_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>school_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SLU"</span>, <span class="st">"Clarkson"</span>, <span class="st">"Rochester"</span>, <span class="st">"RIT"</span>, <span class="st">"Ithaca"</span>, <span class="st">"Skidmore"</span>, <span class="st">"RPI"</span>, <span class="st">"Union"</span>, <span class="st">"Bard"</span>, <span class="st">"Vassar"</span><span class="op">)</span>, hitting_web_url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://clarksonathletics.com/sports/baseball/stats/2022"</span>, 
                 <span class="st">"https://uofrathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://ritathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://athletics.ithaca.edu/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://skidmoreathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://rpiathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://unionathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://bardathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://www.vassarathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span><span class="op">)</span>
<span class="va">school_df</span>
<span class="co">#&gt; # A tibble: 10 x 2</span>
<span class="co">#&gt;    school_name hitting_web_url                              </span>
<span class="co">#&gt;    &lt;chr&gt;       &lt;chr&gt;                                        </span>
<span class="co">#&gt;  1 SLU         https://saintsathletics.com/sports/baseball/…</span>
<span class="co">#&gt;  2 Clarkson    https://clarksonathletics.com/sports/basebal…</span>
<span class="co">#&gt;  3 Rochester   https://uofrathletics.com/sports/baseball/st…</span>
<span class="co">#&gt;  4 RIT         https://ritathletics.com/sports/baseball/sta…</span>
<span class="co">#&gt;  5 Ithaca      https://athletics.ithaca.edu/sports/baseball…</span>
<span class="co">#&gt;  6 Skidmore    https://skidmoreathletics.com/sports/basebal…</span>
<span class="co">#&gt;  7 RPI         https://rpiathletics.com/sports/baseball/sta…</span>
<span class="co">#&gt;  8 Union       https://unionathletics.com/sports/baseball/s…</span>
<span class="co">#&gt;  9 Bard        https://bardathletics.com/sports/baseball/st…</span>
<span class="co">#&gt; 10 Vassar      https://www.vassarathletics.com/sports/baseb…</span></code></pre></div>
<p>One option we have to obtain the hitting statistics for all 10 teams and calculating the <code>wOBA</code> (assuming that the tables are structured the same way on each web page) would be to apply our function 10 times and then bind together the results. The first three applications of the function are shown below.</p>
<div class="sourceCode" id="cb489"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 20 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     6 "Clark… 0.367 1.02  29-19      79    24    29     5</span>
<span class="co">#&gt;  2    19 "Delan… 0.33  0.817 34-34     115    18    38     5</span>
<span class="co">#&gt;  3    13 "Butle… 0.325 1.08  35-35     126    31    41     9</span>
<span class="co">#&gt;  4    30 "Watso… 0.318 0.853 35-33     110    29    35     6</span>
<span class="co">#&gt;  5     5 "Desja… 0.284 0.741 28-20      67    23    19     1</span>
<span class="co">#&gt;  6    20 "Court… 0.281 0.646 27-17      64     6    18     2</span>
<span class="co">#&gt;  7    37 "Goret… 0.268 0.771 32-32      97    18    26     6</span>
<span class="co">#&gt;  8    11 "Circe… 0.252 1.00  35-33     111    27    28     9</span>
<span class="co">#&gt;  9     8 "Forgi… 0.244 0.799 27-27      86    22    21     4</span>
<span class="co">#&gt; 10    41 "Comer… 0.222 0.582 31-21      72    16    16     0</span>
<span class="co">#&gt; 11     7 "Brink… 0.556 1.16  5-1         9     3     5     0</span>
<span class="co">#&gt; 12     1 "Verra… 0.5   1.1   4-0         2     1     1     0</span>
<span class="co">#&gt; 13    25 "Liber… 0.379 1.16  25-19      66    19    25     8</span>
<span class="co">#&gt; 14     9 "Burke… 0.308 0.885 6-4        13     4     4     1</span>
<span class="co">#&gt; 15    23 "Conno… 0.286 0.661 6-0         7     2     2     0</span>
<span class="co">#&gt; 16    18 "Feder… 0.275 0.733 25-7       40    13    11     3</span>
<span class="co">#&gt; 17    22 "Court… 0.256 0.63  20-10      39     7    10     1</span>
<span class="co">#&gt; 18    24 "Colan… 0.095 0.295 15-3       21     6     2     0</span>
<span class="co">#&gt; 19     3 "Haun,… 0     0.5   11-0        2     1     0     0</span>
<span class="co">#&gt; 20    36 "Boldu… 0     0     2-0         2     0     0     0</span>
<span class="co">#&gt; # … with 15 more variables: 3B &lt;int&gt;, HR &lt;int&gt;, RBI &lt;int&gt;,</span>
<span class="co">#&gt; #   TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;, SO &lt;int&gt;,</span>
<span class="co">#&gt; #   GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;, SB-ATT &lt;chr&gt;,</span>
<span class="co">#&gt; #   wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://clarksonathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 26 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    32 "Wilso… 0.349 0.933 31-30     126    32    44    10</span>
<span class="co">#&gt;  2     9 "Doyle… 0.33  1.07  31-31     103    38    34     7</span>
<span class="co">#&gt;  3    26 "Nee, … 0.326 0.958 25-24      86    18    28     8</span>
<span class="co">#&gt;  4    14 "Broui… 0.323 0.941 30-29     127    21    41     8</span>
<span class="co">#&gt;  5     2 "Tito,… 0.278 0.615 29-28      90    19    25     0</span>
<span class="co">#&gt;  6    23 "Bianc… 0.278 0.806 28-27      90    11    25     6</span>
<span class="co">#&gt;  7     3 "Lockl… 0.133 0.46  26-21      45     7     6     1</span>
<span class="co">#&gt;  8    28 "Canto… 0.833 1.83  4-0         6     3     5     1</span>
<span class="co">#&gt;  9    20 "Cuyle… 0.5   1     2-0         2     1     1     0</span>
<span class="co">#&gt; 10    16 "Price… 0.4   1.1   4-1         5     2     2     1</span>
<span class="co">#&gt; # … with 16 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://uofrathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 25 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    22 "Piont… 0.39  1.05  35-31     100    28    39     9</span>
<span class="co">#&gt;  2    10 "Sy, H… 0.357 1.01  40-40     140    32    50     5</span>
<span class="co">#&gt;  3    15 "Whitl… 0.347 1.02  41-41     144    44    50     7</span>
<span class="co">#&gt;  4    16 "Leade… 0.333 0.899 38-35     123    25    41     6</span>
<span class="co">#&gt;  5     7 "Reed,… 0.333 0.877 33-32     111    27    37     7</span>
<span class="co">#&gt;  6    20 "Rende… 0.306 0.939 42-42     147    33    45     9</span>
<span class="co">#&gt;  7     3 "McKin… 0.296 0.786 43-42     135    31    40     8</span>
<span class="co">#&gt;  8     1 "Cappe… 0.281 0.845 37-35     114    21    32     7</span>
<span class="co">#&gt;  9     6 "Karpi… 1     2     20-0        1     0     1     0</span>
<span class="co">#&gt; 10    33 "Const… 0.409 1.07  10-5       22     6     9     1</span>
<span class="co">#&gt; # … with 15 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span></code></pre></div>
<p>For just 10 teams, this approach is certainly doable but is a bit annoying. And, what if we wanted to do this type of calculation for a league with more teams, such as the MLB (Major League Baseball)? Or, for multiple years for each team?</p>
<p>A better approach is to use <strong>iteration</strong> and write code to repeatedly scrape the data from each website and calculate the <code>wOBA</code> statistic with our function. In CS 140, the primary form of iteration you used was probably a <code>for</code> loop. <code>for</code> loops in <code>R</code> have very similar syntax to <code>for</code> loops in Python. However, in general, <code>for</code> loops are clunky, can take up a lot of lines of code, and can be difficult to read.</p>
<p>For this section, we will instead focus on a <strong>functional programming</strong> approach to iteration through the <code>map()</code> function family in <code>purrr</code>. <code>purrr</code> is part of the core <code>tidyverse</code> so the package gets loaded in with <code><a href="https://tidyverse.tidyverse.org">library(tidyverse)</a></code>. The <code>map()</code> function has two arguments: the first is a vector or a list and the second is a function. <code>map()</code> applies the function in the second argument to <strong>each</strong> element of the vector or list in the first argument. For example, consider applying the <code>get_sum_squares</code> function we wrote earlier to a list of vectors:</p>
<div class="sourceCode" id="cb490"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">num_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>vec1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, vec2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, vec3 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">map</span><span class="op">(</span><span class="va">num_list</span>, <span class="va">get_sum_squares</span><span class="op">)</span>
<span class="co">#&gt; $vec1</span>
<span class="co">#&gt; [1] 42</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $vec2</span>
<span class="co">#&gt; [1] 179</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; $vec3</span>
<span class="co">#&gt; [1] 1</span></code></pre></div>
<p>The output is a list of sums of squares calculated with our <code>get_sum_squares()</code> function.</p>
<p>To apply the <code>map()</code> approach to iteration to our baseball web urls, we will create an object called <code>url_vec</code> that has the urls of each school.</p>
<div class="sourceCode" id="cb491"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">url_vec</span> <span class="op">&lt;-</span> <span class="va">school_df</span><span class="op">$</span><span class="va">hitting_web_url</span></code></pre></div>
<p>Then, we apply <code>map()</code> with the first argument being the <code>url_vec</code> and the second argument being the function <code>get_hitting_data()</code> that we wrote earlier.</p>
<div class="sourceCode" id="cb492"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hitting_list</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">url_vec</span>, <span class="va">get_hitting_data</span><span class="op">)</span>
<span class="va">hitting_list</span>
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; # A tibble: 20 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     6 "Clark… 0.367 1.02  29-19      79    24    29     5</span>
<span class="co">#&gt;  2    19 "Delan… 0.33  0.817 34-34     115    18    38     5</span>
<span class="co">#&gt;  3    13 "Butle… 0.325 1.08  35-35     126    31    41     9</span>
<span class="co">#&gt;  4    30 "Watso… 0.318 0.853 35-33     110    29    35     6</span>
<span class="co">#&gt;  5     5 "Desja… 0.284 0.741 28-20      67    23    19     1</span>
<span class="co">#&gt;  6    20 "Court… 0.281 0.646 27-17      64     6    18     2</span>
<span class="co">#&gt;  7    37 "Goret… 0.268 0.771 32-32      97    18    26     6</span>
<span class="co">#&gt;  8    11 "Circe… 0.252 1.00  35-33     111    27    28     9</span>
<span class="co">#&gt;  9     8 "Forgi… 0.244 0.799 27-27      86    22    21     4</span>
<span class="co">#&gt; 10    41 "Comer… 0.222 0.582 31-21      72    16    16     0</span>
<span class="co">#&gt; 11     7 "Brink… 0.556 1.16  5-1         9     3     5     0</span>
<span class="co">#&gt; 12     1 "Verra… 0.5   1.1   4-0         2     1     1     0</span>
<span class="co">#&gt; 13    25 "Liber… 0.379 1.16  25-19      66    19    25     8</span>
<span class="co">#&gt; 14     9 "Burke… 0.308 0.885 6-4        13     4     4     1</span>
<span class="co">#&gt; 15    23 "Conno… 0.286 0.661 6-0         7     2     2     0</span>
<span class="co">#&gt; 16    18 "Feder… 0.275 0.733 25-7       40    13    11     3</span>
<span class="co">#&gt; 17    22 "Court… 0.256 0.63  20-10      39     7    10     1</span>
<span class="co">#&gt; 18    24 "Colan… 0.095 0.295 15-3       21     6     2     0</span>
<span class="co">#&gt; 19     3 "Haun,… 0     0.5   11-0        2     1     0     0</span>
<span class="co">#&gt; 20    36 "Boldu… 0     0     2-0         2     0     0     0</span>
<span class="co">#&gt; # … with 15 more variables: 3B &lt;int&gt;, HR &lt;int&gt;, RBI &lt;int&gt;,</span>
<span class="co">#&gt; #   TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;, SO &lt;int&gt;,</span>
<span class="co">#&gt; #   GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;, SB-ATT &lt;chr&gt;,</span>
<span class="co">#&gt; #   wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; # A tibble: 26 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    32 "Wilso… 0.349 0.933 31-30     126    32    44    10</span>
<span class="co">#&gt;  2     9 "Doyle… 0.33  1.07  31-31     103    38    34     7</span>
<span class="co">#&gt;  3    26 "Nee, … 0.326 0.958 25-24      86    18    28     8</span>
<span class="co">#&gt;  4    14 "Broui… 0.323 0.941 30-29     127    21    41     8</span>
<span class="co">#&gt;  5     2 "Tito,… 0.278 0.615 29-28      90    19    25     0</span>
<span class="co">#&gt;  6    23 "Bianc… 0.278 0.806 28-27      90    11    25     6</span>
<span class="co">#&gt;  7     3 "Lockl… 0.133 0.46  26-21      45     7     6     1</span>
<span class="co">#&gt;  8    28 "Canto… 0.833 1.83  4-0         6     3     5     1</span>
<span class="co">#&gt;  9    20 "Cuyle… 0.5   1     2-0         2     1     1     0</span>
<span class="co">#&gt; 10    16 "Price… 0.4   1.1   4-1         5     2     2     1</span>
<span class="co">#&gt; # … with 16 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; # A tibble: 25 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    22 "Piont… 0.39  1.05  35-31     100    28    39     9</span>
<span class="co">#&gt;  2    10 "Sy, H… 0.357 1.01  40-40     140    32    50     5</span>
<span class="co">#&gt;  3    15 "Whitl… 0.347 1.02  41-41     144    44    50     7</span>
<span class="co">#&gt;  4    16 "Leade… 0.333 0.899 38-35     123    25    41     6</span>
<span class="co">#&gt;  5     7 "Reed,… 0.333 0.877 33-32     111    27    37     7</span>
<span class="co">#&gt;  6    20 "Rende… 0.306 0.939 42-42     147    33    45     9</span>
<span class="co">#&gt;  7     3 "McKin… 0.296 0.786 43-42     135    31    40     8</span>
<span class="co">#&gt;  8     1 "Cappe… 0.281 0.845 37-35     114    21    32     7</span>
<span class="co">#&gt;  9     6 "Karpi… 1     2     20-0        1     0     1     0</span>
<span class="co">#&gt; 10    33 "Const… 0.409 1.07  10-5       22     6     9     1</span>
<span class="co">#&gt; # … with 15 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[4]]</span>
<span class="co">#&gt; # A tibble: 17 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     7 "Libby… 0.303 0.881 38-38     145    26    44    14</span>
<span class="co">#&gt;  2    13 "Dodig… 0.299 0.727 37-37     127    24    38     3</span>
<span class="co">#&gt;  3     1 "Bagle… 0.285 0.772 36-34     123    25    35     5</span>
<span class="co">#&gt;  4    23 "Porte… 0.279 0.783 29-28      86    13    24     6</span>
<span class="co">#&gt;  5    11 "Poorm… 0.238 0.591 30-28     105    15    25     6</span>
<span class="co">#&gt;  6    19 "Reill… 0.237 0.799 38-38     152    30    36     7</span>
<span class="co">#&gt;  7    15 "Marsh… 0.333 0.825 22-19      75    19    25     2</span>
<span class="co">#&gt;  8     9 "Stagn… 0.311 0.824 20-18      61    11    19     1</span>
<span class="co">#&gt;  9    12 "Black… 0.291 0.909 27-27     103    24    30    10</span>
<span class="co">#&gt; 10     5 "Kulp,… 0.276 0.839 23-18      58     9    16     7</span>
<span class="co">#&gt; 11    21 "Colel… 0.26  0.648 27-22      77    13    20     6</span>
<span class="co">#&gt; 12     2 "Kistl… 0.213 0.712 25-21      75     8    16     7</span>
<span class="co">#&gt; 13    33 "Mecca… 0.143 0.488 11-6       21     6     3     0</span>
<span class="co">#&gt; 14    27 "Count… 0.136 0.468 14-7       22     4     3     1</span>
<span class="co">#&gt; 15    44 "Wozny… 0     0.25  4-1         3     0     0     0</span>
<span class="co">#&gt; 16     6 "Sempe… 0     0     2-0         2     0     0     0</span>
<span class="co">#&gt; 17    36 "Fland… 0     0.5   2-0         1     0     0     0</span>
<span class="co">#&gt; # … with 15 more variables: 3B &lt;int&gt;, HR &lt;int&gt;, RBI &lt;int&gt;,</span>
<span class="co">#&gt; #   TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;, SO &lt;int&gt;,</span>
<span class="co">#&gt; #   GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;, SB-ATT &lt;chr&gt;,</span>
<span class="co">#&gt; #   wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[5]]</span>
<span class="co">#&gt; # A tibble: 19 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    29 "Shirl… 0.417 1.24  44-44     156    48    65    23</span>
<span class="co">#&gt;  2     2 "Peder… 0.377 0.897 48-48     207    35    78    19</span>
<span class="co">#&gt;  3    21 "Fabbo… 0.364 1.07  45-45     162    57    59    14</span>
<span class="co">#&gt;  4    30 "Fabia… 0.359 0.976 44-44     153    38    55    11</span>
<span class="co">#&gt;  5    20 "Cutai… 0.339 0.904 48-48     180    35    61    14</span>
<span class="co">#&gt;  6     6 "Merod… 0.284 0.729 47-47     169    26    48     5</span>
<span class="co">#&gt;  7     7 "Brawd… 0.265 0.789 44-41     147    35    39    10</span>
<span class="co">#&gt;  8    19 "Roths… 0.258 0.734 36-33     124    22    32     9</span>
<span class="co">#&gt;  9    17 "Landi… 0.333 0.701 12-2       18     2     6     0</span>
<span class="co">#&gt; 10    14 "Shash… 0.3   0.915 24-11      40    11    12     2</span>
<span class="co">#&gt; 11    13 "Sarub… 0.3   0.9   7-0        10     2     3     0</span>
<span class="co">#&gt; 12     1 "Nauta… 0.296 0.775 31-31     108    35    32     4</span>
<span class="co">#&gt; 13    25 "Laubs… 0.281 0.926 16-4       32     7     9     0</span>
<span class="co">#&gt; 14     5 "Feene… 0.254 0.755 29-14      59    13    15     1</span>
<span class="co">#&gt; 15    18 "McDon… 0.238 0.571 9-7        21     4     5     0</span>
<span class="co">#&gt; 16    26 "Cifon… 0.205 0.648 17-8       39     8     8     2</span>
<span class="co">#&gt; 17    31 "Guidi… 0.182 0.582 4-4        11     3     2     0</span>
<span class="co">#&gt; 18    35 "MacDo… 0.125 0.347 7-1         8     1     1     0</span>
<span class="co">#&gt; 19    28 "Ruffn… 0     0     1-0         1     0     0     0</span>
<span class="co">#&gt; # … with 15 more variables: 3B &lt;int&gt;, HR &lt;int&gt;, RBI &lt;int&gt;,</span>
<span class="co">#&gt; #   TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;, SO &lt;int&gt;,</span>
<span class="co">#&gt; #   GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;, SB-ATT &lt;chr&gt;,</span>
<span class="co">#&gt; #   wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[6]]</span>
<span class="co">#&gt; # A tibble: 21 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    15 "Hornu… 0.46  1.30  37-37     150    54    69    17</span>
<span class="co">#&gt;  2     6 "Bourq… 0.391 0.986 36-35     128    29    50     7</span>
<span class="co">#&gt;  3    21 "O'Nei… 0.366 0.862 36-35     134    32    49     3</span>
<span class="co">#&gt;  4     4 "Torra… 0.289 0.803 31-24      97    17    28     6</span>
<span class="co">#&gt;  5    23 "Mello… 0.287 0.811 32-28     108    14    31     5</span>
<span class="co">#&gt;  6    10 "Melil… 0.281 0.727 37-34     121    33    34     2</span>
<span class="co">#&gt;  7    24 "Snyde… 0.262 0.672 33-30     103    23    27     5</span>
<span class="co">#&gt;  8     2 "Pedem… 0.4   0.9   17-4       20     9     8     0</span>
<span class="co">#&gt;  9    17 "Pelc,… 0.333 1.17  11-1       12     6     4     1</span>
<span class="co">#&gt; 10    25 "Korne… 0.3   0.867 23-8       30     6     9     2</span>
<span class="co">#&gt; # … with 11 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[7]]</span>
<span class="co">#&gt; # A tibble: 22 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    33 "Lives… 0.365 1.01  27-27     104    25    38     8</span>
<span class="co">#&gt;  2    14 "Marin… 0.355 0.938 32-32     124    27    44    11</span>
<span class="co">#&gt;  3    15 "Saia,… 0.337 1.02  29-27      92    24    31     6</span>
<span class="co">#&gt;  4     8 "Defay… 0.294 0.994 32-32     109    31    32     7</span>
<span class="co">#&gt;  5    23 "Moncu… 0.277 0.778 32-32     101    20    28     8</span>
<span class="co">#&gt;  6     2 "Krish… 0.271 0.718 28-25      85    14    23     2</span>
<span class="co">#&gt;  7    44 "Curci… 0.267 0.718 32-32     116    22    31     7</span>
<span class="co">#&gt;  8    40 "Raine… 0.253 0.673 30-30      99    18    25     7</span>
<span class="co">#&gt;  9    38 "Scarp… 0.6   1.2   5-1         5     1     3     0</span>
<span class="co">#&gt; 10     1 "Hicks… 0.364 0.876 20-10      33    10    12     0</span>
<span class="co">#&gt; # … with 12 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[8]]</span>
<span class="co">#&gt; # A tibble: 21 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    55 "Mentz… 0.366 1.00  34-34     112    27    41     9</span>
<span class="co">#&gt;  2     9 "Paris… 0.311 0.773 32-32     119    19    37     8</span>
<span class="co">#&gt;  3    32 "DiNan… 0.303 0.753 31-30     109    19    33     5</span>
<span class="co">#&gt;  4    29 "Straz… 0.299 0.807 27-24      87    18    26     3</span>
<span class="co">#&gt;  5    15 "Santo… 0.298 0.923 30-28      94    18    28     5</span>
<span class="co">#&gt;  6     5 "Cowle… 0.276 0.757 29-27      87    17    24     7</span>
<span class="co">#&gt;  7     1 "Davis… 0.275 0.65  29-22      69     7    19     2</span>
<span class="co">#&gt;  8     6 "Ruzzo… 0.476 1.13  13-5       21     5    10     1</span>
<span class="co">#&gt;  9    13 "Nash,… 0.435 1.20  15-12      46    13    20     3</span>
<span class="co">#&gt; 10    39 "Zieno… 0.333 0.666 7-1         9     0     3     0</span>
<span class="co">#&gt; # … with 11 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[9]]</span>
<span class="co">#&gt; # A tibble: 17 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    37 "Toby,… 0.402 1.14  32-30     107    27    43    11</span>
<span class="co">#&gt;  2    14 "Myers… 0.383 0.989 29-29     107    28    41    11</span>
<span class="co">#&gt;  3     2 "Lusch… 0.317 0.828 28-28     101    28    32     4</span>
<span class="co">#&gt;  4     3 "Stace… 0.283 0.782 27-25      92    21    26     8</span>
<span class="co">#&gt;  5    15 "Fiume… 0.253 0.808 30-30      95    18    24     8</span>
<span class="co">#&gt;  6    25 "Willi… 0.25  0.722 24-21      72    16    18     3</span>
<span class="co">#&gt;  7     6 "Arcio… 0.247 0.699 24-22      77    19    19     6</span>
<span class="co">#&gt;  8    27 "Check… 0.219 0.652 28-24      73    18    16     3</span>
<span class="co">#&gt;  9    24 "Dumpe… 0.4   1.1   4-1         5     0     2     1</span>
<span class="co">#&gt; 10     7 "Hanna… 0.292 0.778 17-13      48    12    14     1</span>
<span class="co">#&gt; 11    26 "O'Too… 0.256 0.683 21-12      39     7    10     0</span>
<span class="co">#&gt; 12    16 "Kurla… 0.25  0.526 9-8        28     1     7     0</span>
<span class="co">#&gt; 13    21 "Famul… 0.241 0.574 14-10      29     4     7     0</span>
<span class="co">#&gt; 14     5 "Rybic… 0.19  0.499 23-18      63     8    12     3</span>
<span class="co">#&gt; 15    18 "Hubbe… 0.182 0.572 9-6        22     3     4     1</span>
<span class="co">#&gt; 16    13 "Lynch… 0.148 0.435 11-6       27     3     4     1</span>
<span class="co">#&gt; 17    22 "Rober… 0.139 0.562 18-10      36     7     5     0</span>
<span class="co">#&gt; # … with 15 more variables: 3B &lt;int&gt;, HR &lt;int&gt;, RBI &lt;int&gt;,</span>
<span class="co">#&gt; #   TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;, HBP &lt;int&gt;, SO &lt;int&gt;,</span>
<span class="co">#&gt; #   GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;, SH &lt;int&gt;, SB-ATT &lt;chr&gt;,</span>
<span class="co">#&gt; #   wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[10]]</span>
<span class="co">#&gt; # A tibble: 25 x 24</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1    23 "Kanel… 0.336 1.07  35-35     128    35    43    13</span>
<span class="co">#&gt;  2    13 "Lapek… 0.333 0.865 34-33     132    28    44    13</span>
<span class="co">#&gt;  3     5 "Reyna… 0.319 0.77  27-19      72    13    23     1</span>
<span class="co">#&gt;  4    35 "Murra… 0.313 0.822 30-19      83    11    26     4</span>
<span class="co">#&gt;  5    28 "Talwa… 0.312 1.06  30-25      77    14    24     6</span>
<span class="co">#&gt;  6     9 "Mills… 0.299 0.911 33-32     127    30    38     8</span>
<span class="co">#&gt;  7     3 "Warre… 0.275 0.744 31-29     102    21    28     3</span>
<span class="co">#&gt;  8    25 "Green… 0.262 0.976 28-21      61    18    16     4</span>
<span class="co">#&gt;  9     8 "Brins… 0.25  0.765 29-19      52     6    13     5</span>
<span class="co">#&gt; 10     1 "Herri… 0.22  0.59  31-15      50     5    11     1</span>
<span class="co">#&gt; # … with 15 more rows, and 15 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;</span></code></pre></div>
<p>Scraping and performing the <code>wOBA</code> calculation will take a few seconds. The output is a list of 10 tibbles. The <code>bind_rows()</code> function that we used to stack rows of different data frames or tibbles can also be used to stack rows of data frames or tibbles given in a list. We apply the function to the scraped data and then add the name of the school to the data frame with a <code>left_join()</code>:</p>
<div class="sourceCode" id="cb493"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hitting_ll</span> <span class="op">&lt;-</span> <span class="va">hitting_list</span> |&gt; <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">left_join</span><span class="op">(</span><span class="va">school_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"url_name"</span> <span class="op">=</span> <span class="st">"hitting_web_url"</span><span class="op">)</span><span class="op">)</span>
<span class="va">hitting_ll</span>
<span class="co">#&gt; # A tibble: 213 x 25</span>
<span class="co">#&gt;      `#` Player    AVG   OPS `GP-GS`    AB     R     H  `2B`</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;   &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt;   &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt;</span>
<span class="co">#&gt;  1     6 "Clark… 0.367 1.02  29-19      79    24    29     5</span>
<span class="co">#&gt;  2    19 "Delan… 0.33  0.817 34-34     115    18    38     5</span>
<span class="co">#&gt;  3    13 "Butle… 0.325 1.08  35-35     126    31    41     9</span>
<span class="co">#&gt;  4    30 "Watso… 0.318 0.853 35-33     110    29    35     6</span>
<span class="co">#&gt;  5     5 "Desja… 0.284 0.741 28-20      67    23    19     1</span>
<span class="co">#&gt;  6    20 "Court… 0.281 0.646 27-17      64     6    18     2</span>
<span class="co">#&gt;  7    37 "Goret… 0.268 0.771 32-32      97    18    26     6</span>
<span class="co">#&gt;  8    11 "Circe… 0.252 1.00  35-33     111    27    28     9</span>
<span class="co">#&gt;  9     8 "Forgi… 0.244 0.799 27-27      86    22    21     4</span>
<span class="co">#&gt; 10    41 "Comer… 0.222 0.582 31-21      72    16    16     0</span>
<span class="co">#&gt; # … with 203 more rows, and 16 more variables: 3B &lt;int&gt;,</span>
<span class="co">#&gt; #   HR &lt;int&gt;, RBI &lt;int&gt;, TB &lt;int&gt;, SLG% &lt;dbl&gt;, BB &lt;int&gt;,</span>
<span class="co">#&gt; #   HBP &lt;int&gt;, SO &lt;int&gt;, GDP &lt;int&gt;, OB% &lt;dbl&gt;, SF &lt;int&gt;,</span>
<span class="co">#&gt; #   SH &lt;int&gt;, SB-ATT &lt;chr&gt;, wOBA &lt;dbl&gt;, url_name &lt;chr&gt;,</span>
<span class="co">#&gt; #   school_name &lt;chr&gt;</span></code></pre></div>
<p>With this data set, we can now do things like figure out the top 3 hitters from each team, according to the <code>wOBA</code> metric:</p>
<div class="sourceCode" id="cb494"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hitting_ll</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">wOBA</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">Player</span>, <span class="va">school_name</span>, <span class="va">wOBA</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 30 x 3</span>
<span class="co">#&gt; # Groups:   school_name [10]</span>
<span class="co">#&gt;    Player                                  school_name  wOBA</span>
<span class="co">#&gt;    &lt;chr&gt;                                   &lt;chr&gt;       &lt;dbl&gt;</span>
<span class="co">#&gt;  1 "Toby, Jared\r\n                      … Bard        0.488</span>
<span class="co">#&gt;  2 "Dumper, Sam\r\n                      … Bard        0.475</span>
<span class="co">#&gt;  3 "Myers, Jordan\r\n                    … Bard        0.431</span>
<span class="co">#&gt;  4 "Cantor, Danny\r\n                    … Clarkson    0.805</span>
<span class="co">#&gt;  5 "Price, Grant\r\n                     … Clarkson    0.475</span>
<span class="co">#&gt;  6 "Doyle, Caleb\r\n                     … Clarkson    0.473</span>
<span class="co">#&gt;  7 "Shirley, Buzz\r\n                    … Ithaca      0.524</span>
<span class="co">#&gt;  8 "Fabbo, Louis\r\n                     … Ithaca      0.465</span>
<span class="co">#&gt;  9 "Fabian, Matt\r\n                     … Ithaca      0.428</span>
<span class="co">#&gt; 10 "Blackall, Patrick \r\n               … RIT         0.399</span>
<span class="co">#&gt; # … with 20 more rows</span></code></pre></div>
<p>or find the players on each team with the most at bats <code>AB</code>:</p>
<div class="sourceCode" id="cb495"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hitting_ll</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">AB</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">Player</span>, <span class="va">school_name</span>, <span class="va">AB</span><span class="op">)</span>
<span class="co">#&gt; # A tibble: 30 x 3</span>
<span class="co">#&gt; # Groups:   school_name [10]</span>
<span class="co">#&gt;    Player                                  school_name    AB</span>
<span class="co">#&gt;    &lt;chr&gt;                                   &lt;chr&gt;       &lt;int&gt;</span>
<span class="co">#&gt;  1 "Toby, Jared\r\n                      … Bard          107</span>
<span class="co">#&gt;  2 "Myers, Jordan\r\n                    … Bard          107</span>
<span class="co">#&gt;  3 "Luscher, Alex\r\n                    … Bard          101</span>
<span class="co">#&gt;  4 "Brouillette, Colby\r\n               … Clarkson      127</span>
<span class="co">#&gt;  5 "Wilson, Kent\r\n                     … Clarkson      126</span>
<span class="co">#&gt;  6 "Doyle, Caleb\r\n                     … Clarkson      103</span>
<span class="co">#&gt;  7 "Pedersen, Connor\r\n                 … Ithaca        207</span>
<span class="co">#&gt;  8 "Cutaia, Nicholas\r\n                 … Ithaca        180</span>
<span class="co">#&gt;  9 "Merod, Gil\r\n                       … Ithaca        169</span>
<span class="co">#&gt; 10 "Reilly, Chris\r\n                    … RIT           152</span>
<span class="co">#&gt; # … with 20 more rows</span></code></pre></div>
</div>
<div id="exercise-15-3" class="section level3" number="16.3.3">
<h3>
<span class="header-section-number">16.3.3</span> Exercises<a class="anchor" aria-label="anchor" href="#exercise-15-3"><i class="fas fa-link"></i></a>
</h3>
<p>Exercises marked with an * indicate that the exercise has a solution at the end of the chapter at <a href="connections-to-stat-113-stat-213-and-cs-140.html#solutions-15">16.5</a>.</p>
<p>The code below scrapes data from a wikipedia page listing the billboard end of year “hot 100” songs for the year 2021</p>
<div class="sourceCode" id="cb496"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>

<span class="va">year_scrape</span> <span class="op">&lt;-</span> <span class="fl">2021</span>
<span class="va">url</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"https://en.wikipedia.org/wiki/Billboard_Year-End_Hot_100_singles_of_"</span>, <span class="va">year_scrape</span><span class="op">)</span>

<span class="co">## convert the html code into something R can read</span>
<span class="va">billboard_tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">url</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>

<span class="co">## grabs the tables</span>
<span class="va">billboard_df</span> <span class="op">&lt;-</span> <span class="va">billboard_tab</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>year <span class="op">=</span> <span class="va">year_scrape</span><span class="op">)</span>
<span class="va">billboard_df</span>
<span class="co">#&gt; # A tibble: 100 x 4</span>
<span class="co">#&gt;      No. Title              `Artist(s)`                 year</span>
<span class="co">#&gt;    &lt;int&gt; &lt;chr&gt;              &lt;chr&gt;                      &lt;dbl&gt;</span>
<span class="co">#&gt;  1     1 "\"Levitating\""   Dua Lipa                    2021</span>
<span class="co">#&gt;  2     2 "\"Save Your Tear… The Weeknd and Ariana Gra…  2021</span>
<span class="co">#&gt;  3     3 "\"Blinding Light… The Weeknd                  2021</span>
<span class="co">#&gt;  4     4 "\"Mood\""         24kGoldn featuring Iann D…  2021</span>
<span class="co">#&gt;  5     5 "\"Good 4 U\""     Olivia Rodrigo              2021</span>
<span class="co">#&gt;  6     6 "\"Kiss Me More\"" Doja Cat featuring SZA      2021</span>
<span class="co">#&gt;  7     7 "\"Leave the Door… Silk Sonic (Bruno Mars an…  2021</span>
<span class="co">#&gt;  8     8 "\"Drivers Licens… Olivia Rodrigo              2021</span>
<span class="co">#&gt;  9     9 "\"Montero (Call … Lil Nas X                   2021</span>
<span class="co">#&gt; 10    10 "\"Peaches\""      Justin Bieber featuring D…  2021</span>
<span class="co">#&gt; # … with 90 more rows</span></code></pre></div>
<ol style="list-style-type: decimal">
<li><p>Wrap the code above in a function that scrapes data from Wikipedia for a user-provided <code>year_scrape</code> argument.</p></li>
<li><p>Create either a vector of the years 2014 through 2021 or a list of the years 2014 through 2021. Use your vector or list, along with the function you wrote in Exercise 1, to scrape data tables from each year.</p></li>
<li><p>Combine the data frames you scraped in Exercise 2 and use the combined data set to figure out which artist appears the highest number of times in the billboard hot 100 list within the years 2014 through 2021.</p></li>
<li><p>* Note that your solution to Exercise 3 is likely imperfect because of songs that feature another musical artist. Why would such songs present a problem in counting the number of songs for each artist?</p></li>
</ol>
</div>
</div>
<div id="chapexercise-15" class="section level2" number="16.4">
<h2>
<span class="header-section-number">16.4</span> Chapter Exercises<a class="anchor" aria-label="anchor" href="#chapexercise-15"><i class="fas fa-link"></i></a>
</h2>
<p>There are no chapter exercises for this section on connections to STAT 113, STAT 213, and CS 140.</p>
</div>
<div id="solutions-15" class="section level2" number="16.5">
<h2>
<span class="header-section-number">16.5</span> Exercise Solutions<a class="anchor" aria-label="anchor" href="#solutions-15"><i class="fas fa-link"></i></a>
</h2>
<div id="stat-113-s" class="section level3" number="16.5.1">
<h3>
<span class="header-section-number">16.5.1</span> STAT 113 S<a class="anchor" aria-label="anchor" href="#stat-113-s"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="stat-213-s" class="section level3" number="16.5.2">
<h3>
<span class="header-section-number">16.5.2</span> STAT 213 S<a class="anchor" aria-label="anchor" href="#stat-213-s"><i class="fas fa-link"></i></a>
</h3>
</div>
<div id="cs-140-s" class="section level3" number="16.5.3">
<h3>
<span class="header-section-number">16.5.3</span> CS 140 S<a class="anchor" aria-label="anchor" href="#cs-140-s"><i class="fas fa-link"></i></a>
</h3>
<ol start="4" style="list-style-type: decimal">
<li>* Note that your solution to Exercise 3 is likely imperfect because of songs that feature another musical artist. Why would such songs present a problem in counting the number of songs for each artist?</li>
</ol>
<p>When we <code>group_by()</code> musical artist and use our counting function <code>n()</code>, the artist by themselves and the artist featuring the other musician would be counted separately in our table.</p>
</div>
</div>
<div id="rcode-15" class="section level2" number="16.6">
<h2>
<span class="header-section-number">16.6</span> Non-Exercise <code>R</code> Code<a class="anchor" aria-label="anchor" href="#rcode-15"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb497"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://openintrostat.github.io/openintro/">openintro</a></span><span class="op">)</span>
<span class="va">resume</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="va">resume_sum</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt; 
  <span class="fu">mutate</span><span class="op">(</span>received_callback <span class="op">=</span> <span class="va">received_callback</span><span class="op">)</span> |&gt;
           <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>, <span class="va">received_callback</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_sum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">received_callback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_c</span><span class="op">(</span><span class="op">)</span>
<span class="va">resume</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>received_callback <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">received_callback</span><span class="op">)</span><span class="op">)</span>
<span class="va">resume_sum</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt; 
           <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>, <span class="va">received_callback</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_sum</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">race</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_col</span><span class="op">(</span><span class="fu">aes</span><span class="op">(</span>fill <span class="op">=</span> <span class="va">received_callback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">scale_fill_viridis_d</span><span class="op">(</span><span class="op">)</span>
<span class="va">resume</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">race</span>, <span class="va">received_callback</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>count <span class="op">=</span> <span class="fu">n</span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">pivot_wider</span><span class="op">(</span>names_from <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"race"</span><span class="op">)</span>,
              values_from <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/stats/chisq.test.html">chisq.test</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">resume</span><span class="op">$</span><span class="va">race</span>, y <span class="op">=</span> <span class="va">resume</span><span class="op">$</span><span class="va">received_callback</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">job_type</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Job Type"</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="fu">fct_rev</span><span class="op">(</span><span class="fu">fct_infreq</span><span class="op">(</span><span class="va">job_industry</span><span class="op">)</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_bar</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">coord_flip</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">labs</span><span class="op">(</span>x <span class="op">=</span> <span class="st">"Job Industry"</span><span class="op">)</span>
<span class="va">resume_firstname</span> <span class="op">&lt;-</span> <span class="va">resume</span> |&gt;
  <span class="fu">group_by</span><span class="op">(</span><span class="va">firstname</span><span class="op">)</span> |&gt;
  <span class="fu">summarise</span><span class="op">(</span>propcallback <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">received_callback</span> <span class="op">==</span> <span class="st">"1"</span><span class="op">)</span>,
            gender <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">gender</span><span class="op">)</span>,
            race <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">race</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">propcallback</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">unite</span><span class="op">(</span><span class="st">"gender_race"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="va">gender</span>, <span class="va">race</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_firstname</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gender_race</span>, y <span class="op">=</span> <span class="va">propcallback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/slowkow/ggrepel">ggrepel</a></span><span class="op">)</span>
<span class="va">label_df</span> <span class="op">&lt;-</span> <span class="va">resume_firstname</span> |&gt; 
  <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">propcallback</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">max</a></span><span class="op">(</span><span class="va">propcallback</span><span class="op">)</span> <span class="op">|</span>
           <span class="va">propcallback</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html">min</a></span><span class="op">(</span><span class="va">propcallback</span><span class="op">)</span><span class="op">)</span>

<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">resume_firstname</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">gender_race</span>, y <span class="op">=</span> <span class="va">propcallback</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://rdrr.io/pkg/ggrepel/man/geom_text_repel.html">geom_label_repel</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">label_df</span>, <span class="fu">aes</span><span class="op">(</span>label <span class="op">=</span> <span class="va">firstname</span><span class="op">)</span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://broom.tidymodels.org/">broom</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://here.r-lib.org/">here</a></span><span class="op">)</span>
<span class="va">coffee_df</span> <span class="op">&lt;-</span> <span class="fu">read_csv</span><span class="op">(</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html">here</a></span><span class="op">(</span><span class="st">"data/coffee_ratings.csv"</span><span class="op">)</span><span class="op">)</span>
<span class="va">coffee_mod</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html">lm</a></span><span class="op">(</span><span class="va">total_cup_points</span> <span class="op">~</span> <span class="va">species</span> <span class="op">+</span> <span class="va">aroma</span> <span class="op">+</span> <span class="va">flavor</span> <span class="op">+</span>
                   <span class="va">sweetness</span> <span class="op">+</span> <span class="va">moisture</span>,
   data <span class="op">=</span> <span class="va">coffee_df</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/summary.html">summary</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span><span class="op">$</span><span class="va">coefficients</span><span class="op">[</span><span class="st">"moisture"</span>, <span class="fl">4</span><span class="op">]</span>
<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">p.value</span><span class="op">)</span>
<span class="fu"><a href="https://generics.r-lib.org/reference/tidy.html">tidy</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">term</span> <span class="op">==</span> <span class="st">"aroma"</span><span class="op">)</span>
<span class="fu"><a href="https://generics.r-lib.org/reference/glance.html">glance</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="va">augment_df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://generics.r-lib.org/reference/augment.html">augment</a></span><span class="op">(</span><span class="va">coffee_mod</span><span class="op">)</span>
<span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.cooksd</span> <span class="op">&gt;</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">coffee_df</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_cup_points</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_histogram</span><span class="op">(</span>bins <span class="op">=</span> <span class="fl">15</span>, fill <span class="op">=</span> <span class="st">"white"</span>, colour <span class="op">=</span> <span class="st">"black"</span><span class="op">)</span>
<span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.hat</span> <span class="op">&gt;</span> <span class="fl">0.2</span><span class="op">)</span>
<span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.std.resid</span> <span class="op">&gt;</span> <span class="fl">3</span> <span class="op">|</span> <span class="va">.std.resid</span> <span class="op">&lt;</span> <span class="op">-</span><span class="fl">3</span><span class="op">)</span>
<span class="fu">ggplot</span><span class="op">(</span>data <span class="op">=</span> <span class="va">augment_df</span> |&gt; <span class="fu"><a href="https://rdrr.io/r/stats/filter.html">filter</a></span><span class="op">(</span><span class="va">.fitted</span> <span class="op">&gt;</span> <span class="fl">25</span><span class="op">)</span>, <span class="fu">aes</span><span class="op">(</span>x <span class="op">=</span> <span class="va">.fitted</span>, y <span class="op">=</span> <span class="va">.resid</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu">geom_point</span><span class="op">(</span><span class="op">)</span> 
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://rvest.tidyverse.org/">rvest</a></span><span class="op">)</span>

<span class="va">url_SLU</span> <span class="op">&lt;-</span> <span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span>
<span class="va">tab_SLU</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">url_SLU</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
<span class="va">SLU_Hitting</span> <span class="op">&lt;-</span> <span class="va">tab_SLU</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> |&gt;
  <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fl">23</span><span class="op">)</span> |&gt;
  <span class="fu">mutate</span><span class="op">(</span>wOBA <span class="op">=</span> <span class="op">(</span><span class="fl">0.69</span> <span class="op">*</span> <span class="va">BB</span> <span class="op">+</span> <span class="fl">0.72</span> <span class="op">*</span> <span class="va">HBP</span> <span class="op">+</span> <span class="fl">0.89</span> <span class="op">*</span> <span class="op">(</span><span class="va">H</span><span class="op">-</span><span class="va">`2B`</span><span class="op">-</span><span class="va">`3B`</span><span class="op">-</span><span class="va">`HR`</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1.27</span> <span class="op">*</span> <span class="va">`2B`</span> <span class="op">+</span> <span class="fl">1.62</span> <span class="op">*</span> <span class="va">`3B`</span> <span class="op">+</span> <span class="fl">2.10</span> <span class="op">*</span> <span class="va">HR</span><span class="op">)</span> <span class="op">/</span> <span class="op">(</span><span class="va">AB</span> <span class="op">+</span> <span class="va">BB</span> <span class="op">+</span> <span class="va">SF</span> <span class="op">+</span> <span class="va">HBP</span><span class="op">)</span><span class="op">)</span>
<span class="va">SLU_Hitting</span> |&gt; <span class="fu">select</span><span class="op">(</span><span class="va">wOBA</span>, <span class="fu"><a href="https://tidyselect.r-lib.org/reference/everything.html">everything</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span> |&gt; <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">wOBA</span><span class="op">)</span><span class="op">)</span>
<span class="va">get_sum_squares</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">x_vec</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">sum_of_squares</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">x_vec</span> <span class="op">^</span> <span class="fl">2</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">sum_of_squares</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">get_sum_squares</span><span class="op">(</span>x_vec <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">1</span><span class="op">)</span><span class="op">)</span>
<span class="va">get_hitting_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">url_name</span><span class="op">)</span> <span class="op">{</span>
  
  <span class="va">tab</span> <span class="op">&lt;-</span> <span class="fu"><a href="http://xml2.r-lib.org/reference/read_xml.html">read_html</a></span><span class="op">(</span><span class="va">url_name</span><span class="op">)</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/rename.html">html_nodes</a></span><span class="op">(</span><span class="st">"table"</span><span class="op">)</span>
  
  <span class="va">hitting</span> <span class="op">&lt;-</span> <span class="va">tab</span><span class="op">[[</span><span class="fl">1</span><span class="op">]</span><span class="op">]</span> |&gt; <span class="fu"><a href="https://rvest.tidyverse.org/reference/html_table.html">html_table</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> |&gt;
    <span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span><span class="op">(</span><span class="op">-</span><span class="fl">2</span><span class="op">)</span> |&gt;
    <span class="fu">select</span><span class="op">(</span><span class="op">-</span><span class="fl">23</span><span class="op">)</span> |&gt;
    <span class="fu">mutate</span><span class="op">(</span>wOBA <span class="op">=</span> <span class="op">(</span><span class="fl">0.69</span> <span class="op">*</span> <span class="va">BB</span> <span class="op">+</span> <span class="fl">0.72</span> <span class="op">*</span> <span class="va">HBP</span> <span class="op">+</span> <span class="fl">0.89</span> <span class="op">*</span> <span class="op">(</span><span class="va">H</span><span class="op">-</span> <span class="va">`2B`</span> <span class="op">-</span> <span class="va">`3B`</span> <span class="op">-</span> <span class="va">`HR`</span><span class="op">)</span> <span class="op">+</span>
                     <span class="fl">1.27</span> <span class="op">*</span> <span class="va">`2B`</span> <span class="op">+</span> <span class="fl">1.62</span> <span class="op">*</span> <span class="va">`3B`</span> <span class="op">+</span> <span class="fl">2.10</span> <span class="op">*</span> <span class="va">HR</span><span class="op">)</span> <span class="op">/</span> 
             <span class="op">(</span><span class="va">AB</span> <span class="op">+</span> <span class="va">BB</span> <span class="op">+</span> <span class="va">SF</span> <span class="op">+</span> <span class="va">HBP</span><span class="op">)</span>,
           url_name <span class="op">=</span> <span class="va">url_name</span><span class="op">)</span>
  
  <span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">hitting</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="va">school_df</span> <span class="op">&lt;-</span> <span class="fu">tibble</span><span class="op">(</span>school_name <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"SLU"</span>, <span class="st">"Clarkson"</span>, <span class="st">"Rochester"</span>, <span class="st">"RIT"</span>, <span class="st">"Ithaca"</span>, <span class="st">"Skidmore"</span>, <span class="st">"RPI"</span>, <span class="st">"Union"</span>, <span class="st">"Bard"</span>, <span class="st">"Vassar"</span><span class="op">)</span>, hitting_web_url <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://clarksonathletics.com/sports/baseball/stats/2022"</span>, 
                 <span class="st">"https://uofrathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://ritathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://athletics.ithaca.edu/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://skidmoreathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://rpiathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://unionathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://bardathletics.com/sports/baseball/stats/2022"</span>,
                 <span class="st">"https://www.vassarathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span><span class="op">)</span>
<span class="va">school_df</span>
<span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://saintsathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://clarksonathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="fu">get_hitting_data</span><span class="op">(</span>url_name <span class="op">=</span> <span class="st">"https://uofrathletics.com/sports/baseball/stats/2022"</span><span class="op">)</span>
<span class="va">num_list</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span><span class="op">(</span>vec1 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">4</span>, <span class="fl">5</span><span class="op">)</span>, vec2 <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">9</span>, <span class="fl">8</span>, <span class="fl">3</span>, <span class="fl">5</span><span class="op">)</span>, vec3 <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>
<span class="fu">map</span><span class="op">(</span><span class="va">num_list</span>, <span class="va">get_sum_squares</span><span class="op">)</span>
<span class="va">url_vec</span> <span class="op">&lt;-</span> <span class="va">school_df</span><span class="op">$</span><span class="va">hitting_web_url</span>
<span class="va">hitting_list</span> <span class="op">&lt;-</span> <span class="fu">map</span><span class="op">(</span><span class="va">url_vec</span>, <span class="va">get_hitting_data</span><span class="op">)</span>
<span class="va">hitting_list</span>
<span class="va">hitting_ll</span> <span class="op">&lt;-</span> <span class="va">hitting_list</span> |&gt; <span class="fu">bind_rows</span><span class="op">(</span><span class="op">)</span> |&gt;
  <span class="fu">left_join</span><span class="op">(</span><span class="va">school_df</span>, by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"url_name"</span> <span class="op">=</span> <span class="st">"hitting_web_url"</span><span class="op">)</span><span class="op">)</span>
<span class="va">hitting_ll</span>
<span class="va">hitting_ll</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">wOBA</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">Player</span>, <span class="va">school_name</span>, <span class="va">wOBA</span><span class="op">)</span>
<span class="va">hitting_ll</span> |&gt; <span class="fu">group_by</span><span class="op">(</span><span class="va">school_name</span><span class="op">)</span> |&gt;
  <span class="fu">arrange</span><span class="op">(</span><span class="fu">desc</span><span class="op">(</span><span class="va">AB</span><span class="op">)</span><span class="op">)</span> |&gt;
  <span class="fu">slice</span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span><span class="op">)</span> |&gt;
  <span class="fu">select</span><span class="op">(</span><span class="va">Player</span>, <span class="va">school_name</span>, <span class="va">AB</span><span class="op">)</span></code></pre></div>

</div>
</div>
  <div class="chapter-nav">
<div class="prev"><a href="predictive-modeling-with-knn.html"><span class="header-section-number">15</span> Predictive Modeling with knn</a></div>
<div class="next"><a href="introduction-to-sql-with-dbplyr.html"><span class="header-section-number">17</span> Introduction to SQL with dbplyr</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#connections-to-stat-113-stat-213-and-cs-140"><span class="header-section-number">16</span> Connections to STAT 113, STAT 213, and CS 140</a></li>
<li>
<a class="nav-link" href="#stat-113"><span class="header-section-number">16.1</span> STAT 113</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#chi-square-test-of-association"><span class="header-section-number">16.1.1</span> Chi-square Test of Association</a></li>
<li><a class="nav-link" href="#additional-analysis"><span class="header-section-number">16.1.2</span> Additional Analysis</a></li>
<li><a class="nav-link" href="#exercise-15-1"><span class="header-section-number">16.1.3</span> Exercises</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#stat-213"><span class="header-section-number">16.2</span> STAT 213</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#broom-package-functions"><span class="header-section-number">16.2.1</span> broom Package Functions</a></li>
<li><a class="nav-link" href="#exercise-15-2"><span class="header-section-number">16.2.2</span> Exercises</a></li>
</ul>
</li>
<li>
<a class="nav-link" href="#cs-140"><span class="header-section-number">16.3</span> CS 140</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#functions"><span class="header-section-number">16.3.1</span> Functions</a></li>
<li><a class="nav-link" href="#iteration"><span class="header-section-number">16.3.2</span> Iteration</a></li>
<li><a class="nav-link" href="#exercise-15-3"><span class="header-section-number">16.3.3</span> Exercises</a></li>
</ul>
</li>
<li><a class="nav-link" href="#chapexercise-15"><span class="header-section-number">16.4</span> Chapter Exercises</a></li>
<li>
<a class="nav-link" href="#solutions-15"><span class="header-section-number">16.5</span> Exercise Solutions</a><ul class="nav navbar-nav">
<li><a class="nav-link" href="#stat-113-s"><span class="header-section-number">16.5.1</span> STAT 113 S</a></li>
<li><a class="nav-link" href="#stat-213-s"><span class="header-section-number">16.5.2</span> STAT 213 S</a></li>
<li><a class="nav-link" href="#cs-140-s"><span class="header-section-number">16.5.3</span> CS 140 S</a></li>
</ul>
</li>
<li><a class="nav-link" href="#rcode-15"><span class="header-section-number">16.6</span> Non-Exercise R Code</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
          
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>STAT 234: Data Science</strong>" was written by Matt Higham. It was last built on 2022-07-28.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
